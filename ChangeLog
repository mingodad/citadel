$Log$
Revision 400.68  2002/12/25 07:06:00  ajc
* Tweaked the code to work with libical 0.24

Revision 400.67  2002/12/20 04:50:00  ajc
* When saving a calendar event, increment the SEQUENCE property.

Revision 400.66  2002/12/18 05:03:39  ajc
* In the calendar code, changed all "struct tm *" to "struct tm" and changed
  all "tm = localtime(foo)" to "memcpy(&tm, localtime(foo), sizeof(struct tm))"
  Because the libc-allocated buffer was getting clobbered.
* This fixes the problem fleeb reported with Feb 1 events making it go nuts.

Revision 400.65  2002/12/17 05:01:39  ajc
* Prettied up the calendar day view layout
* Hour/minute editing fields now use am/pm hours and 2-digit minutes

Revision 400.64  2002/12/16 04:43:30  ajc
* Correctly handle local time zone when figuring out which day and time to
  display events on calendar month/day views.  This also seems to have
  fixed the bug that was causing events to sometimes get lost when saved.

Revision 400.63  2002/12/15 05:50:59  ajc
* Form editing of date/time fields now assumes that the icaltimetype being
  manipulated is in UTC.  It converts to/from local time for editing.

Revision 400.62  2002/12/10 23:25:47  ajc
* Display attendees in message view of calendar objects

Revision 400.61  2002/12/07 22:12:59  ajc
* Handle incoming RSVP's for meetings.  (Note: this will not actually work
  until I implement the Citadel server function which it calls.)

Revision 400.60  2002/11/30 21:34:51  ajc
* Submit organizer in a hidden field, in case the server needs it

Revision 400.59  2002/11/30 04:46:46  ajc
* First cut at adding/removing attendees to an event
  (Actual invitations should be sent by the Citadel server)

Revision 400.58  2002/11/29 23:56:19  ajc
* Completed "me as organizer" -- the user's own e-mail address is inserted
  as the organizer of new events.  Detect when the user is the organizer and
  enable/disable the attendees box accordingly.

Revision 400.57  2002/11/29 16:38:37  ajc
* Started some "me as organizer" stuff.  (BROKEN BUILD ... I'll fix soon.)

Revision 400.56  2002/11/28 06:03:24  ajc
* Issue an ISME command when editing an event, to determine whether the user
  viewing the event is the organizer.  (Will use this later to allow/disallow
  sending out invitations.)

Revision 400.55  2002/11/26 05:01:04  ajc
* Began handling attendee fields

Revision 400.54  2002/11/16 23:40:11  ajc
* Calendar view

Revision 400.53  2002/11/16 23:15:02  ajc
* Make the "all day event" shadebox smaller (month view) - no border.
* Fixed bug that caused any events following an all day event to also appear
  with the shadebox.

Revision 400.52  2002/11/16 05:40:54  ajc
* When adding new events to the calendar, default to the month [and day]
  currently being viewed.
* Hotlink each hour of the day view to an add-new-event for that day/hour.

Revision 400.51  2002/11/15 05:05:47  ajc
* Put in back/forward (yesterday/tomorrow) links in calendar day view

Revision 400.50  2002/11/15 04:11:46  ajc
* Added even more nifty JavaScript to cause the hour/minute and end date
  fields of a calendar event form to render as disabled when the "all day
  event" box is checked -- not just when the user checks the box, but also
  when the box begins its life already checked.

Revision 400.49  2002/11/14 04:59:40  ajc
* Correctly serialize and save all day events using date instead of date/time

Revision 400.48  2002/11/13 04:49:23  ajc
* "All day event" shows as a single checkbox, instead of one for the start
  time and one for the end time.  Added nifty JavaScript to zero and shade
  the hour/minute and all end time fields when all-day-event is checked.

Revision 400.47  2002/11/12 05:57:27  ajc
* Display a nicer looking screen when replying to calendar invitations
* When displaying day view, don't show all day events twice
* Day or month view: denote all day events by displaying them inside
  a grey box.

Revision 400.46  2002/11/12 03:26:39  ajc
* Tell the user about broken Citadel server connections instead of
  simply printing "Goodbye"

Revision 400.45  2002/10/23 04:11:38  ajc
* Detect when a meeting invitation is actually an update for an existing UID
  and tell the user so.

Revision 400.44  2002/10/21 20:16:38  ajc
* Display conflicts nicely

Revision 400.43  2002/10/21 18:29:14  ajc
* Ask server to hunt for conflicts when displaying a meeting invitation

Revision 400.42  2002/10/19 21:28:32  ajc
* Moved the calendar meeting request reply functionality to the Citadel server

Revision 400.41  2002/10/19 17:10:14  ajc
* Add "Tentative" accept button
* Only display Accept/Tentative/Decline button when method=REQUEST

Revision 400.40  2002/10/19 04:16:37  ajc
* Save an incoming meeting request into the user's calendar.

Revision 400.39  2002/10/18 20:55:05  ajc
* Began work on meeting request accept/decline

Revision 400.38  2002/10/16 19:16:39  ajc
* Fixes and updates to build WebCit on Linux for IBM S/390

Revision 400.37  2002/10/09 04:12:44  ajc
* Templatized trailing HTML
* Templatized "new start page" page
* Added global substitution macros

Revision 400.36  2002/10/09 03:51:01  ajc
* Templatized the <HEAD> section of HTML

Revision 400.35  2002/10/07 23:03:38  ajc
* messages.c: don't display room name field when it's blank

Revision 400.34  2002/10/07 04:10:37  ajc
* When displaying meeting invitations, only show date/time for VEVENT
  subcomponents.  Date/time for other subcomponents are irrelevant.
* Cleaned up HTML display of meeting invitations.

Revision 400.33  2002/10/03 03:40:31  ajc
* Worked on meeting accept/decline a little bit

Revision 400.32  2002/09/30 03:58:35  ajc
* Dabbled in handling incoming meeting requests

Revision 400.31  2002/09/29 20:15:43  ajc
* Completed the calendar day view

Revision 400.30  2002/09/28 04:01:30  ajc
* started fleshing out the calendar day view

Revision 400.29  2002/09/27 21:19:28  ajc
* Add new event

Revision 400.28  2002/09/27 18:31:33  ajc
* Properly handle VEVENT saves (fixed nasty loopy loopy bug)
* After saving a VEVENT, return to the correct calendar view and date

Revision 400.27  2002/09/27 17:15:44  ajc
* Removed the gzip compression stuff due to bugs in Internet Explorer.

Revision 400.26  2002/09/27 04:37:21  ajc
* New, buggy versions of event editing screens

Revision 400.25  2002/09/26 22:00:16  ajc
* Fixed buggy month-selection algorithm (January is month 0 in 'struct tm' but
  month 1 in libical functions)

Revision 400.24  2002/09/25 21:57:13  ajc
* Keep track of msgnums in the two-pass calendar loop, so we can hotlink to
  individual items

Revision 400.23  2002/09/24 04:12:34  ajc
* Rough cut of the two-pass calendar display routines (first pass: go thru
  messages gathering VEVENT items; second pass: render calendar with data)

Revision 400.22  2002/09/23 04:01:33  ajc
* Presentation changes to calendar month view

Revision 400.21  2002/09/22 05:20:27  ajc
* Began implementing month view

Revision 400.20  2002/09/21 04:38:05  ajc
* Added utility functions for displaying vcalendar timestamps in web forms
  and translating form data back to timestamps.
* Completed the "edit task" and "add new task" screens.

Revision 400.19  2002/09/20 20:28:08  ajc
* Smooth transition between "list tasks" & "edit task" screens

Revision 400.18  2002/09/20 03:54:44  ajc
* Display the "Tasks" view as a bulleted list with each task clickable
* Clicking brings up an (unfinished) "edit task" screen

Revision 400.17  2002/09/18 21:44:02  ajc
* display VTODO parameters

Revision 400.16  2002/09/17 04:21:00  ajc
* Handler chains for VCALENDAR and VTODO types

Revision 400.15  2002/09/17 03:37:10  ajc
* Implemented a 'display handler' infrastructure for various groupware types

Revision 400.14  2002/09/16 03:35:12  ajc
* Just a bunch of glue code to iterate through the various types of ical
  objects we could encounter

Revision 400.13  2002/09/15 04:05:41  ajc
* Process calendar object subcomponents

Revision 400.12  2002/09/15 03:40:13  ajc
* calendar.c: added
* When a text/calendar MIME type is discovered in a message, send it to
  the (currently skeleton) parser in calendar.c
* calendar.c: skeleton parser for calendar objects which currently just
  creates an icalcomponent object and frees it.

Revision 400.11  2002/09/15 03:16:24  ajc
* Changed decode_base64() to CtdlDecodeBase64() to avoid conflict with
  function namespace in libical

Revision 400.10  2002/09/15 02:50:55  ajc
* Duh.  I don't need to twiddle CFLAGS when autoconf provides -DHAVE_ZLIB_H

Revision 400.9  2002/09/14 21:33:31  ajc
* Backed out compression of inlines -- not all browsers appear to handle it

Revision 400.8  2002/09/14 20:20:29  ajc
* Attempting to push more stuff through compression.  I've introduced some
  sort of deadlock bug that I can't seem to find yet...

Revision 400.7  2002/09/14 20:00:22  ajc
* Compress output_image() graphics

Revision 400.6  2002/09/14 16:26:35  ajc
* output_image() now reads the entire image from Citadel into a buffer before
  sending it to the browser (for performance reasons, and so it can compress)

Revision 400.5  2002/09/14 04:52:59  ajc
* Look for the "libical" calendaring library and link it in if present...

Revision 400.4  2002/09/14 04:02:36  ajc
* Finished gzip compression of dynamic pages (when browser supports it)

Revision 400.3  2002/09/13 20:40:53  ajc
* Detect when the client browser is capable of gzip encoding
  (actual encoding is not implemented yet)

Revision 400.2  2002/09/13 15:54:40  ajc
* Reversed the above change because I broke it somehow

Revision 400.1  2002/09/11 22:46:59  ajc
* Started adding in compression and calendaring library detects (not finished)

Revision 400.0  2002/09/09 03:56:11  ajc
* This is version 4.00

Revision 323.68  2002/09/09 03:51:01  ajc
* In the HTML-to-HTML converter:
  --> Open links in new window (as with text msgs)
  --> Convert loose URL's to hot links (as with text msgs)

Revision 323.67  2002/09/06 03:59:11  ajc
* Added an "About this server" panel to the Summary page.
  (Useless fluff, but better than an empty column.)

Revision 323.66  2002/08/26 02:57:06  ajc
* Rooms listed on the summary page are now clickable-gotoable

Revision 323.65  2002/08/26 01:24:09  ajc
* Added a "summary" page (rather sparse for now)

Revision 323.64  2002/08/24 15:30:48  ajc
* GET instead of POST for listsub.  Also add a 'Back...' link.

Revision 323.63  2002/08/24 05:59:24  ajc
* Bugfixes and cosmetic changes to listsub system

Revision 323.62  2002/08/23 03:37:19  ajc
* Finished all of the subscribe/unsubscribe/confirm stuff!  (I think)

Revision 323.61  2002/08/22 03:55:47  ajc
* 'unsubscribe' command (but not 'confirm unsubscribe')

Revision 323.60  2002/08/21 21:58:37  ajc
* Completed self-service list subscription via web.
  (Still need to implement unsubscribe.)

Revision 323.59  2002/08/16 22:06:51  ajc
* self-service

Revision 323.58  2002/08/16 03:51:12  ajc
* I think I've finally nailed the 'no session' pages now...

Revision 323.57  2002/08/15 03:49:47  ajc
* Fleshed out the list subscription page a bit

Revision 323.56  2002/08/13 19:55:12  ajc
* Keep track of the HTTP "Host:" header being sent by the browser.
  (We're going to need this in the near future)

Revision 323.55  2002/08/05 16:07:30  ajc
* Moved "edit floor label pic" to the floor editing screen

Revision 323.54  2002/08/05 15:53:00  ajc
* Commands to add, change, delete floors

Revision 323.53  2002/07/26 03:20:04  ajc
* Beautified the folder tabs in "edit room"

Revision 323.52  2002/07/25 04:01:58  ajc
* Final cleanup of changes (finally located and fixed the bug)

Revision 323.51  2002/07/24 04:14:23  ajc
* Minor code cleanup of last night's changes

Revision 323.50  2002/07/23 15:40:54  ajc
* Minor cleanup of previous changes

Revision 323.49  2002/07/23 04:43:58  ajc
* Updated message reading to use the new MSG4 command, so we can do output
  of various types of richtext (mainly HTML).

Revision 323.48  2002/07/16 03:37:24  ajc
* Small change to above

Revision 323.47  2002/07/16 03:23:37  ajc
* Display HTML messages as HTML.  (Wow!)

Revision 323.46  2002/07/13 04:39:59  ajc
* Handle multipart/alternative in a nicer way, giving us the opportunity to
  output HTML instead of converting to text/plain and back.  (Not finished.)

Revision 323.45  2002/07/11 03:17:03  ajc
* hacks to text_to_server() to transmit messages as HTML

Revision 323.44  2002/07/09 04:21:12  ajc
* 'idle' icon

Revision 323.43  2002/07/06 03:10:26  ajc
* Enable a "make this my start page" link that works in lots of places.
  Configures a user's preference of where to go after login.

Revision 323.42  2002/06/19 22:01:31  ajc
* When editing another user's vCard, do a "transient goto" to their config
  room so you don't automatically gain access to their config room.
* When creating a user, go back to the "select user to edit" screen with the
  new user's account name pre-selected.

Revision 323.41  2002/06/17 03:48:44  ajc
* Finished the thing to edit other users' vCards.

Revision 323.40  2002/06/16 21:49:02  ajc
* Administratively edit other users' vCards.  Still needs a couple of lines
  of glue code to make it work.

Revision 323.39  2002/06/15 20:34:39  ajc
* Use safestrncpy() instead of strncpy() where appropriate
* Fixed a memory allocation bug in the vCard parser

Revision 323.38  2002/05/23 03:40:05  ajc
* Brought over a utility function I'll need later

Revision 323.37  2002/05/22 02:34:56  ajc
* Finished room/folder view selector.  Pretty cool.

Revision 323.36  2002/05/22 01:53:23  ajc
* Room list or folder list?  Give the user a choice.  (Has bugs.)

Revision 323.35  2002/05/12 15:21:43  error
* do_template() now parses a .wml file for WAP clients, and a .html file
  for everybody else

Revision 323.34  2002/05/11 22:46:19  error
* Track whether user-agent is a WAP gateway

Revision 323.33  2002/05/11 15:35:07  error
* webcit.c: add MIME types for WAP/WML

Revision 323.32  2002/05/10 15:29:58  ajc
* Hacked the address book view a little bit

Revision 323.31  2002/05/09 03:53:56  ajc
* Began working on address book view

Revision 323.30  2002/05/08 03:38:58  ajc
* Preferences framework

Revision 323.29  2002/05/07 03:57:29  ajc
* In message summary, replace 'Del' links with checkboxes

Revision 323.28  2002/05/05 03:28:15  ajc
* Shuffled around the room banner a bit

Revision 323.27  2002/05/03 19:32:39  ajc
* Finished "folder list" mode (still need to move it to a permanent location)

Revision 323.26  2002/05/03 03:55:17  ajc
* more folder display stuff

Revision 323.25  2002/05/01 22:03:07  ajc
* "folder list" view (not finished)

Revision 323.24  2002/05/01 03:23:31  ajc
* Added a drop-down box to change a user's view of a room.

Revision 323.23  2002/04/28 03:56:47  ajc
* Finished summary mode (for the most part, anyway)

Revision 323.22  2002/04/26 21:13:21  ajc
* Separated "summary mode" message listing into its own function
* Go to summary mode automatically when the server says that view=1

Revision 323.21  2002/04/20 04:14:29  ajc
* Some work on email summary screen

Revision 323.20  2002/03/31 05:02:39  ajc
* Remove "Page another user" link from main menu
* Add "edit my citadel config room" type link from edit user screen

Revision 323.19  2002/03/29 22:30:45  ajc
* Finished the "edit user" screen.

Revision 323.18  2002/03/29 15:18:09  ajc
* yep ... more user edit stuff

Revision 323.17  2002/03/26 19:01:12  ajc
* More edit user stuff

Revision 323.16  2002/03/26 18:23:23  ajc
* Don't display room banner on screens that don't pertain to a particular room
* Initial prep for add/change/delete user accounts screen

Revision 323.15  2002/03/22 04:33:08  ajc
* "vcard edit" button for _other_ users' My Citadel Config rooms as well

Revision 323.14  2002/03/19 04:35:10  ajc
* Brought over yet another new version of the MIME parser from Citadel

Revision 323.13  2002/03/13 03:56:52  ajc
* New site config option "Allow system Aides to gain access to mailboxes"

Revision 323.12  2002/03/12 23:13:57  ajc
* Moved room access controls out of the admin menu and into the room commands
  menu.  Prettied up the access control list screen.

Revision 323.11  2002/03/10 06:07:09  ajc
* Handle multiple Internet e-mail addresses in vCard editor

Revision 323.10  2002/03/07 04:56:09  ajc
* Final polish for initial round of vCard editing functions.  Only show "edit"
  link when editing user's own vCard in the My Citadel Config> room.

Revision 323.9  2002/03/06 05:22:33  ajc
* More vcard editing form stuff

Revision 323.8  2002/03/05 05:05:06  ajc
* More vCard editing stuff

Revision 323.7  2002/03/04 05:28:54  ajc
* Wrote some skeleton code for robust vCard editing

Revision 323.6  2002/03/03 06:58:25  ajc
* Login errors displayed in red

Revision 323.5  2002/03/03 06:52:59  ajc
* Allow editing of the "disable self-service user account creation" site config option

Revision 323.4  2002/02/24 07:02:44  ajc
* Added the ability to enter a Subject: line in messages
* Go to the Mail room when user clicks on the new mail alert icon

Revision 323.3  2002/02/13 22:47:51  ajc
* Added some rudimentary support for displaying vCards as card-looking things

Revision 323.2  2002/02/13 15:04:25  ajc
* Began some hacks for vCard processing

Revision 323.0  2002/01/13 09:07:06  ajc
* THIS IS 3.23

Revision 322.4  2002/01/13 09:06:38  ajc
* Brought over the debugged mime parser from Citadel

Revision 322.3  2002/01/05 06:19:17  error
* Add MIME types text/css and image/png

Revision 322.2  2002/01/03 22:32:38  ajc
* templatized the "prompt for recipient" screen

Revision 322.1  2001/12/28 09:43:05  error
* Client support for hostnames up to 63 characters

Revision 322.0  2001/12/26 23:11:56  ajc
* THIS IS 3.22

Revision 321.1  2001/12/26 23:11:25  ajc
* Minor change to the upload handler, to fix graphics uploads

Revision 321.0  2001/12/26 05:28:02  ajc
* THIS IS 3.21

Revision 320.2  2001/12/26 05:24:11  ajc
* Reverted all of the navbar and iconbar functions back to plain, ordinary
  link tags.  The nifty JavaScript stuff is now used only to light up the
  buttons during mouse hovers, and nothing more.

Revision 320.1  2001/12/25 00:14:44  error
* Fixed the iconbar and navbar buttons; they now work in Netscape 4.x

Revision 320.0  2001/12/21 06:04:03  ajc
* THIS IS 3.20

Revision 301.22  2001/12/21 06:03:54  ajc
* 3.20

Revision 301.21  2001/12/20 05:02:42  ajc
* If you paid for this software, someone is ripping you off.
* Fixed the urlesc() function to use a caller-supplied target buffer.

Revision 301.20  2001/12/18 20:35:29  ajc
* More fun JavaScript-enabled buttons

Revision 301.19  2001/12/18 16:48:06  ajc
* Began testing new JavaScript-enabled k00l light-up buttonz

Revision 301.18  2001/12/18 06:06:20  ajc
* mime parser update

Revision 301.17  2001/12/15 20:51:33  ajc
* "reply" button on pop-up pages

Revision 301.16  2001/12/11 16:02:40  ajc
* Completed support for add/remove mailing list recipients.

Revision 301.15  2001/12/11 15:22:53  ajc
* Began constructing the listserv screen for config (not tested)

Revision 301.14  2001/12/11 05:37:12  ajc
* Finished the share/unshare room screen in Edit Room

Revision 301.13  2001/12/03 04:43:40  ajc
* Brought over an update of the MIME parser from Citadel.

Revision 301.12  2001/12/02 07:09:13  ajc
* Turned the room editing page into a tabbed dialog
* Started adding some of the room sharing stuff

Revision 301.11  2001/11/22 05:17:06  ajc
* Completed the add/change/delete neighbor node screens

Revision 301.10  2001/11/18 01:47:24  ajc
* Tentatively begun the change of networking configuration screens to reflect
  the new network architecture of the server.

Revision 301.9  2001/11/18 01:41:09  ajc
* Brought over the newer string tokenizer from Citadel
* Upgraded all the generic string buffers to 4096 bytes, using the Citadel
  server's convention of #define SIZ 4096

Revision 301.8  2001/11/14 03:20:22  ajc
* Add some more of the newer config settings to the site config screen

Revision 301.7  2001/09/25 03:34:09  ajc
* Fix for WebCit servers running on port 80: detect Windoze worm-of-the-week
  and bail out without bothering the Citadel server.

Revision 301.6  2001/08/22 16:38:06  ajc
* Added the "-c" command line option to generate optional cookies indicating
  the host name of the server.  This makes it easy to put a cluster of WebCit
  servers behind (for example) an Arrowpoint load balancer.

Revision 301.5  2001/08/21 04:02:56  ajc
* Added some more meta-tags to (hopefully) prevent the "lame goto" caused by
  unwanted page caching

Revision 301.4  2001/08/13 03:43:24  ajc
* Got it!

Revision 301.3  2001/08/13 03:40:01  ajc
* Another attempt at focus

Revision 301.2  2001/08/11 04:24:39  ajc
* Attempt at setting focus to msgtext area when entering a message.

Revision 301.1  2001/08/02 03:42:03  ajc
* Changed the wholist to work with the new masquerade semantics

Revision 301.0  2001/06/28 15:05:31  ajc
* tag for 3.01

Revision 300.2  2001/06/28 15:03:49  ajc
* Every generated page now includes a meta tag to disable evil "smart tags"
  (see http://smarttags.manilasites.com/ for more information)

Revision 300.1  2001/06/28 02:39:54  ajc
* Placated users who whine about privacy policy by adding MESG ROOMACCESS to
  the screen where you can create a room...

Revision 300.0  2001/06/27 06:24:06  ajc
* Tagged everything as Version 3.00

Revision 213.25  2001/06/27 06:22:49  ajc
* Updated docs for the 3.00 release

Revision 213.24  2001/06/27 06:16:01  ajc
* Correct generated window name in pop up pages
* Added handling of MIME inline images (not tested)

Revision 213.23  2001/06/22 17:58:20  ajc
* A few performance and tuning cleanups.  Increased the size of the socket
  queue length to 100 for use on big systems.  Also, during startup, the
  initial startup thread now exits after creating the worker threads, instead
  of becoming a worker thread itself.  For some reason Solaris had problems
  with the latter method.

Revision 213.22  2001/06/07 03:16:57  ajc
* Brought over an updated mime parser from Citadel

Revision 213.21  2001/06/06 14:44:25  ajc
* mime_parser.c: #include <pthread.h> so it compiles cleanly

Revision 213.20  2001/05/31 02:26:22  ajc
* Fixed login to take you to the Lobby instead of the next room.

Revision 213.19  2001/05/30 22:37:09  ajc
* Fix to upload handler to recognize browser uploads based on *either* a "name"
  or a "filename" from the MIME parser.

Revision 213.18  2001/05/30 01:06:57  ajc
* Changes to mime parser ... still something wrong

Revision 213.17  2001/05/28 19:27:29  ajc
* Fixed bug which marked all messages in Lobby as old before reading at login

Revision 213.16  2001/05/25 22:39:26  ajc
* Brought over the new MIME parser from Citadel.  WARNING: BROKEN BUILD!!

Revision 213.15  2001/05/23 16:15:23  ajc
* UI changes (pretty frames with no scrollbars)

Revision 213.14  2001/05/22 00:32:17  ajc
* cosmetics

Revision 213.13  2001/05/22 00:02:18  ajc
* Another attempt to fix the fd leak

Revision 213.12  2001/05/19 02:21:40  ajc
* Attempt to fix the dangling sockets.

Revision 213.11  2001/05/15 03:22:25  ajc
* More icon updates and link cleanup type stuff

Revision 213.10  2001/05/06 05:11:48  ajc
* Added paging icon and right-justified it
* Send-page window is now a popup

Revision 213.9  2001/05/04 04:28:10  ajc
* Added "page user" button in wholist

Revision 213.8  2001/05/01 00:49:43  ajc
* more of the UI overhaul

Revision 213.7  2001/04/30 01:49:36  ajc
* more work on UI overhaul

Revision 213.6  2001/04/29 04:39:23  ajc
* User interface overhaul now in progress.  WARNING: incomplete system.

Revision 213.5  2001/04/01 22:13:37  cough
* Modified roomops.c to give users the ability to pick a floor at room
  creation time.

Revision 213.4  2001/02/15 01:21:55  ajc
* Applied a patch submitted by Andru Luvisi to add who-knows-room and
  invite/kickout functionality.

Revision 213.3  2001/01/25 23:10:00  ajc
* "Delete message" button now confirms on client-side using JavaScript

Revision 213.2  2000/12/05 18:39:49  ajc
* Added support for non-USA countries in registration screen (requires the
  latest Citadel server, which supports the country field)

Revision 213.1  2000/10/20 04:27:46  ajc
* zapped_list() -- fixed broken HTML tags.  (Closes bug #76.)

Revision 213.0  2000/10/03 16:44:01  ajc
* Tagged for 2.13 release

Revision 212.16  2000/10/03 03:15:53  ajc
* Cosmetic changes to login screen, menu bar, and message header bar

Revision 212.15  2000/09/28 03:44:52  ajc
* Linked to the bio/photo page from message headers.  I'm not sure I like the
  color scheme, though.

Revision 212.14  2000/09/28 03:37:23  ajc
* who.c: provide links to bio/photo pages for each user in the wholist

Revision 212.13  2000/09/24 21:37:21  ajc
* When reading large numbers of messages, group them in smaller numbers and
  display the selector bar in search engine style (like AltaVista and Google)

Revision 212.12  2000/09/24 04:17:16  ajc
* Templatized the room banner.

Revision 212.11  2000/09/17 03:29:45  ajc
* Templatized the "<BODY BACKGROUND=...>" type stuff that starts each page.

Revision 212.10  2000/09/14 11:43:37  error
Replace occurrences of % throughout the HTML with %% so as to be friendly
to HP/UX printf() and possibly others.

Revision 212.9  2000/09/13 04:13:59  ajc
* Completed the initial hack of the variable substitution template thingy.
  Check out static/login.html to see the first template.

Revision 212.8  2000/09/11 17:08:16  ajc
* Started templatizing the login screen.  Not finished yet.

Revision 212.7  2000/09/11 03:29:50  ajc
* Started working on a variable-substitution thing

Revision 212.6  2000/08/30 03:20:22  ajc
* Put the wholist back into its own window.

Revision 212.5  2000/07/06 03:46:29  ajc
* Fixed the count in 'there are xxx messages remaining."  (Closes bug #61)

Revision 212.4  2000/06/29 04:22:35  ajc
* Changed the format of the wholis (again).  Now it shows up in a frame
  instead of a separate window.

Revision 212.3  2000/06/12 03:28:44  ajc
* added support for multi-line paging

Revision 212.2  2000/06/07 04:11:28  ajc
* HTML changes to room banner

Revision 212.1  2000/05/31 04:29:54  ajc
* Initial support for "summary" (headers only, no body) mode of reading
  messages, and "read one" mode.  For future support of 'traditional' email.

Revision 212.0  2000/05/23 20:35:52  ajc
* Tagged for the 2.12 release

Revision 211.19  2000/05/18 02:33:39  ajc
* Don't call whobbs() directly after changing masq room/host, it screws up the
  refresh.  It now calls an HTTP redirect page instead.
* added http_redirect(char *url) function to accomplish the above

Revision 211.18  2000/05/08 17:24:32  ajc
* Removed HTTP date fields because it was confusing browser caches (weird)
* Moved express messages to a pop-up HTML window (as opposed to a dialog box)

Revision 211.17  2000/05/07 23:46:55  ajc
* added Date: and Last-Modified: headers to HTTP output
* masquerade room/host screen now runs in wholist window, and returns to it

Revision 211.16  2000/05/02 17:32:06  ajc
* Font related changes to html

Revision 211.15  2000/04/20 02:42:23  ajc
* tcp_sockets.c: changed memcpy() to memset() in tcp_connectsock; this was
  crashing every session, every time.  (?)
* End the session after displaying robots.txt or nocookies.html, to prevent
  big session logjams when either of these conditions are met

Revision 211.14  2000/04/15 15:43:46  nbryant
* warning fix for 64-bit compile on ultrasparc. (kids don't try this at home,
  64-bit gcc on sparc is evil)

Revision 211.13  2000/04/06 20:42:03  nbryant
* configure.in: fix a typo

Revision 211.12  2000/04/06 20:37:01  nbryant
* solaris cleanups and warning fixes

Revision 211.11  2000/03/31 03:48:52  ajc
* text_to_server() now behaves the way web users expect text entry to work.
  Soft linebreaks are soft, hard linebreaks are hard.  No indentation.

Revision 211.10  2000/03/31 02:39:06  ajc
* Fixed bugs in "Site configuration" and added new fields.

Revision 211.9  2000/03/31 02:08:45  ajc
* Added "max messages per page" and "read next nnn" stuff to read loop
  (probably not in its final form)

Revision 211.8  2000/03/28 17:02:47  nbryant
* configure.in: check for -lsocket -lnsl on Solaris and other SVR4-alikes

Revision 211.7  2000/03/27 16:18:17  ajc
* Implement multi-room chat as available in Citadel 5.70

Revision 211.6  2000/03/23 04:45:15  ajc
* Experimental move of wholist to a separate auto-refreshing window

Revision 211.5  2000/03/19 22:49:03  ajc
* Made the header-bar buttons more visible
* Added a "reply" header-bar button
* Move "Subject:" lines into the header-bar
* Padded the header-bars by one pixel (nicer looking)
* Changed message date/time output format

Revision 211.4  2000/03/19 19:49:31  ajc
* Added support for unix domain sockets

Revision 211.3  2000/02/11 23:45:04  nbryant
* Makefile.in, configure.in: add, like, some *more* code for FreeBSD
* tcp_sockets.c: include <arpa/inet.h>

Revision 211.2  2000/02/11 23:30:04  nbryant
configure.in: added some code for FreeBSD

Revision 211.1  2000/01/11 04:20:40  ajc
* Add "close window" option to goodbye screen

Revision 211.0  2000/01/04 15:24:16  ajc
* Worked around HTTP bugs in Internet Explorer 5.  Die, Bill, Die.
* This will be released as v2.11; tagged everything as such.

Revision 210.0  1999/12/24 04:57:18  ajc
* 2.10 release

Revision 1.121  1999/12/23 04:54:48  ajc
* Changed session cookie from hexadecimal encoding to base64
* Removed overly verbose logging

Revision 1.120  1999/12/12 18:12:28  ajc
* get http request: clear hold buffer before starting to read in HTTP request.
  This was causing some requests to get corrupted.

Revision 1.119  1999/12/08 18:25:21  ajc
* Increased the size of the backlog queue length passed to accept() and made
  it a configuration parameter in webcit.h

Revision 1.118  1999/12/07 16:09:26  ajc
* Better (non fireworks display mode) handling of broken HTTP sockets

Revision 1.117  1999/12/06 03:40:29  ajc
* Moved a bunch of other global variables to per-session variables

Revision 1.116  1999/12/06 02:05:33  ajc
* Moved global march list into per-session context

Revision 1.115  1999/12/05 18:38:02  ajc
* Auto-scaling worker thread pool size

Revision 1.114  1999/12/05 17:38:41  ajc
* Additional debugging and cleanup

Revision 1.113  1999/12/04 22:16:05  ajc
* Moved all diagnostic output to stderr
* Moved "HTTP/1.0 200 OK" output to output_headers()

Revision 1.112  1999/12/04 21:56:59  ajc
* Finished the overhaul.  Now to tune...

Revision 1.111  1999/12/03 17:59:53  ajc
* BROKEN BUILD.  Wrote most of the session removal code, but some of it is
  pseudocode so the build is currently broken.

Revision 1.110  1999/12/03 16:37:46  ajc
* Repaired HTTP output for image transfers and static content

Revision 1.109  1999/12/03 05:09:54  ajc
* Rewrote the HTTP engine and application coupling to run in a worker thread
  model and to run as a single multithreaded program (eliminated helper
  processes and pipes).  It currently runs but has many large bugs.

Revision 1.108  1999/12/03 00:18:20  ajc
* Added ".c.o" rule to Makefile

Revision 1.107  1999/11/26 03:32:59  ajc
* Started moving all of the global variables into a struct, to facilitate
  multithreaded server.

Revision 1.106  1999/11/26 01:28:10  ajc
* 2.01 release

Revision 1.105  1999/11/04 02:05:02  ajc
* Added 'number of worker threads' to site config screen

Revision 1.104  1999/10/25 02:25:09  ajc
* Shuffled around the room editing commands

Revision 1.103  1999/10/14 04:07:18  ajc
* Cleaned up the bottom-of-page icons

Revision 1.102  1999/10/08 23:58:11  ajc
* Minor bug fix in registration screen

Revision 1.101  1999/10/06 02:44:02  ajc
* Per Nick's request, removed the key bindings stuff.  He knows how to fit
  it back in when it's fixed.  Also added more attempts at cache disabling,
  but it still doesn't work in the StarOffice browser.  I don't know why.

Revision 1.100  1999/10/02 03:26:14  ajc
* Merged in Nick's bit of JavaScript to handle key commands.
  BROKEN BUILD ALERT!!  This runs all the time, even when the cursor is
  in a text field.  Right now you can't even log in.

Revision 1.99  1999/09/01 01:06:11  ajc
* Added "max message length" field in global config screen

Revision 1.98  1999/08/14 18:16:10  ajc
* Fixed escputs() and its friends to properly handle ' (single quote) chars


Sun Jul 18 20:17:58 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Did neat stuff to the bottom of the page

Mon Jul 12 23:30:24 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us> 
	* webcit.c: exit Webcit sessions semi-gracefully when the connection
	  to a Citadel server fails.
	* messages.c: don't auto-link URL's in messages if it would cause
	  a buffer overrun.

Sat Jul 10 17:51:39 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Recompiled the Java chat applet using a genuine JDK 1.0.2
	  compiler.  This should make more browsers happy.

Wed Jun 30 19:19:59 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Added support for "robots.txt" telling spiders to go away.
	* Do a slrp_highest() when logging off.

Sat Jun 26 22:52:13 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Rearranged the code in "Site-wide configuration" and "Generic
	  server command" to avoid nested server operations

Wed Jun 23 21:43:30 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* webcit.c: added "back, top, next" buttons to bottom of each page
	* menubar.html: replaced "User list" with "Page another user"

Tue Jun 22 14:53:05 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* context_loop.c: rearranged some code to try to eliminate deadlocks

Fri Jun 18 11:55:58 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Unknown URL's now display the main menu instead of diagnostics
	* Diagnostics are now at <baseurl>/diagnostics

Mon Jun  7 21:59:45 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Session no longer locks up when an express message is cancelled
	* The default Citadel server is now "localhost" instead of uncnsrd
	* Added some documentation

Thu Jun  3 12:18:49 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* roomops.c: made room banner graphics more reliable
	* messages.c: added code to prevent accidental "double-posting"
	* who.c: fixed the "Change room/host/user" submit logic

Thu Jun  2 09:48:00 EDT 1999 Nick Grossman <nick@ulster.net>
	* Changed static/menubar.html so the text is readable

Wed Jun  2 23:47:58 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Ditched the frames mode completely.  It wasn't working properly in,
	  among other places, IE 5.  Die, Bill, Die.

Sat May 29 00:25:47 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Fixed the behavior of the "forget room" routine, to properly handle
	  the transition back to the Lobby after it's all done.
	* Added ExpressMessageCat() to allow code to send the user messages
	  along with incoming express messages
	* WebCit now sends the name of the end user's browser as the client
	  name in a Citadel IDEN command rather than its own name.

Fri May 21 23:35:17 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Minor code cleanups
	* New mail notification

Mon May 17 20:59:36 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Top-aligned all the cells in the fake frames in non-frames mode

Fri May 14 23:37:02 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Initial entry to _BASEROOM_ at login now done as a Skip instead
	  of a Goto, in order to prevent it from first marking all msgs old.

Mon May 10 23:09:34 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Replaced _most_ gotoroom() calls with smart_goto(), a version
	  which can differentiate the needs of frames and noframes modes

Sat May  8 01:07:06 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* webserver.c: added "-t" option to send traces somewhere else

Tue Apr 27 23:36:35 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* context_loop.c: display an error page if the client browser
	  requests a non-root page and there is no cookie set
	* webserver.c: took my name off the copyright notice (it's a group
	  effort, after all)

Sun Apr 18 23:42:54 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Reworked a lot of the structure, made more HTML "embeddable"
	* Changed the noframes mode to display "fake" frames using tables

Thu Apr 16 12:00:00 EDT 1999 Nick Grossman <nick@ulster.net>
	Changed some output formatting (mainly <FONT> tags).
	Changed who.c to use urlescputs() rather than escputs()
	in urls so GOTOs and User Profiles work when the string has a
	space in it.

Wed Apr 14 17:56:18 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	http://www.webreference.com/dhtml/column18/menuFrLoad.html
	How to cause "onLoad=" to cause a sibling frame to refresh without
	having to use the nonportable HTTP "Window-Target:" directive.  Began
	implementation of this; it should allow portable NS/IE compatibility.

Wed Apr  7 21:51:33 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Implemented "access level required to create rooms"

Thu Mar 18 00:23:05 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* webcit.c: modified getz() to *exit* the program when fgets()
	  returns an error.  This is actually the desired behavior; it would
	  otherwise busy-loop forever on a broken pipe.

Sat Mar  6 19:56:07 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* webcit.c: added to getz() the ability to return an error code;
	  implemented this in the main loop, hopefully fixing problems
	* Added "braindamage" file (frames/JS browser compatibility list)
	* Added HTTP "User-agent:" detection
	* wildmat.c, braindamage.c: added
	* Initial value of 'noframes' is now set by the braindamage check
	* Ran everything through "indent -kr -i8"
	* roomops.c: in room list, print a &nbsp; in otherwise empty cells

1999-02-24 Nathan Bryant <bryant@cs.usm.maine.edu>
	* context_loop.c: warning fix
	* webcit.c: off_t is a 64-bit `long long' on BSDI (eek!)

Sat Jan 30 19:00:58 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Resolve the name of the connecting host and pass it on to Citadel

Fri Jan 29 14:49:49 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* wDumpContent() is now responsible for </BODY></HTML> most of the
	  time (parameter settable) so that the main menu can easily be
	  embedded in every page when running in noframes mode
	* noframes mode selection is now carried in the cookie

Thu Jan 28 20:30:08 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Made the frames stuff less dependent on the HTML TARGET= directive
	  and more dependent on the HTTP Window-target: directive.
	* Made the system semi-navigable in noframes mode.

Sat Jan 23 19:36:10 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Brought over the new room listing code and <G>oto heuristics
	  from the main Citadel tree, to pay attention to floor/room ordering

Thu Jan 14 17:14:11 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Modified the back end of mime_parser to use callbacks instead of
	  doing something specific.  Now we can use it elsewhere.

Mon Jan 11 21:53:16 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Fixed the bugs in "Site-wide configuration"
	* Added a "generic server commands" screen

Fri Jan  8 22:20:54 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Reduced the multiple cookies down to one cookie combining all data.

Mon Jan  4 23:04:36 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Removed wc_host and wc_port cookies.
	* Added an "edit your session" screen to change your wholisting.

Sun Jan  3 20:05:31 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Added "enter registration"
	* Set up automatic trigger of Enter Registration when the server
	  says it's needed
	* Established that a one-to-one WebCit/Citadel correspondence will
	  be required.  No big deal due to shared code segments.
	* Added "change password"
	* Added networking configuration screens.  These still need testing.
	* Added a "kill session" link to each line of the wholist when
	  logged in as an aide, and the screens to perform this operation.

Thu Dec 31 21:53:20 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Final cvs commit for 1998 (an awful year, I'm glad to see it over).
	* "Finished" the MIME parser.
	* Got image uploads working.
	* Added "add/edit user photo" screens.
	* Added "add/edit room graphic" screens.
	* Added "add/edit floor graphic" screens.
	* Fixed display of floor graphic in known rooms list.

Wed Dec 30 20:36:13 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Wrote mime_parser.c for handling of image uploads.  This will also
	  be used in future Citadel MIME projects.

Tue Dec 29 23:25:50 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Fixed a bug in the room banner display code
	* Added "delete room"
	* Added "validate users"

Mon Dec 28 00:26:01 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Added "edit room info file"
	* Added "edit bio"

Sat Dec 26 23:12:47 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Changed the "auto read new" functionality from a meta refresh tag
	  to an "onload" directive (the former was causing graphics problems)
	* Added "create room"
	* Added "edit room"

Tue Dec 22 22:35:50 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Got the Zap and List-Zapped commands working
	* Added a convenience function to display a page with an error string
	* Automatically do a read-new-msgs whenever a new room banner is loaded

Thu Dec 17 20:38:00 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Added the screens to send pages
	* Changed message headers to display in bigger font, non-boldface
	* Added the chat system
	* Added goto private rooms

Wed Dec 16 16:23:58 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Replace "Citadel/UX" in menu bar with the Citadel/UX logo

1998-12-14 Nathan Bryant <bryant@cs.usm.maine.edu>
	* automatically regenerate Makefile when Makefile.in changes

Sun Dec 13 13:35:12 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* context_loop.c: Moved "remove session" into its own function.
	  Check for dead webcit child process before each transaction.
	* Ignore SIGPIPE; this seems to magically make the program bulletproof
	  against broken HTTP connections.
	* Added a housekeeping thread to periodically remove dead sessions
	  and kill idle sessions.
	* messages.c: added "delete message" functionality
	* messages.c: added "move message" functionality
	* userlist.c: added.  This adds "userlist" and "show user" functions.
	* roomops.c: fixed buggy implementation of ungoto
	* Set up an option in output_headers() to optionally print the most
	  often used opening HTML as well as the HTTP headers.
	* Display express messages in cute little JavaScript popup window.

Fri Dec 11 21:14:36 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Brought over message reading and entry functions from old WebCit

1998-12-10 Nathan Bryant <bryant@cs.usm.maine.edu>
	* context_loop.c: really fix the SO_LINGER stuff
	* webserver.c: remove commented-out references to SO_LINGER

Wed Dec  9 18:50:46 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* context_loop.c: After fork(), child process closes the HTTP socket
	  so when the parent process closes it, it actually _does_ close.
	  Otherwise, aIEeeee and possibly other browsers will hang.
	* Added support for graphics images retrieved from the Citadel server.
	* Set up login banner graphic and background image graphic

1998-12-09 Nathan Bryant <bryant@cs.usm.maine.edu>
	* context_loop.c, webserver.c, webserver.h: SO_LINGER and locking fix

Wed Dec  9 11:13:48 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Smoothed out some of the login/logout code.  Failed authentication
	  now works the way it should.
	* Added support for new user login (still need to handle registration).

Tue Dec  8 15:45:42 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Discovered that the HTTP socket problem is related to a socket that
	  isn't properly lingering on close.  Temporarily hacked a sleep(10)
	  into context_loop.c until it is figured out.

Mon Dec  7 17:03:18 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Did a little debugging, still trying to figure out why logging in
	  displays "Connection reset by peer" error.  It used to work...

1998-12-07 Nathan Bryant <bryant@cs.usm.maine.edu>
	* Makefile.in: updated dependencies

Sun Dec  6 19:50:55 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Fixed broken interpretation of variables specified in the URL
	* added new "action" variable to make main loop simpler

1998-12-06 Nathan Bryant <bryant@cs.usm.maine.edu>
	* webserver.c: prototype vsnprintf
	* context_loop.c: warning fix

1998-12-05 Nathan Bryant <bryant@cs.usm.maine.edu>
	* tcp_sockets.c: removed some dead code
	* context_loop.c: oops, I made a memory leak. fix fix fix. also close
	  unused ends of pipes, fix a file descriptor leak and a race condition
	* portability enhancements

1998-12-04 Nathan Bryant <bryant@cs.usm.maine.edu>
	* webserver.c, context_loop.c, webcit.c: add commandline args for host
	  and port
	* converted to autoconf and began port to Digital UNIX
	* warning fixes
	* context_loop.c: moved the monster 64k buffer array off the stack
	* tcp_sockets.c: getservbyname() doesn't set errno.

1998-12-03 Nathan Bryant <bryant@cs.usm.maine.edu>
	* webserver.c: warning fix
