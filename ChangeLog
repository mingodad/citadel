$Id$

Wed Dec 21 10:22:51 EST 2005 ajc
* configure.in: use different variable names for each AC_CHECK_PROG macro,
  because autoconf will see the same variable name as used before, pull some
  value from cache, and assume it knows the answer.  This causes NLS to be
  enabled on systems that have, for example, xgettext but not msgfmt (such as
  Mandrake).  Fixed.

Wed Dec 21 10:08:18 EST 2005 ajc
* Makefile.in: target 'distclean' - do not remove po/Makefile.in 

Sat Dec 17 00:24:05 EST 2005 ajc
* messages.c: include the "edit html source" button in the message editor
  window.  Also, when pullquoting a message, insert a \n\n at the end so
  the TinyMCE editor allows the user to advance past the quote.

Thu Dec 15 23:50:45 EST 2005 ajc
* Checkbox to allow anonymous posting in rooms which allow it.
  Resolves bugzilla #65.

Thu Dec 15 17:35:47 EST 2005 ajc
* "Headers" option in view message

Tue Dec 13 17:50:57 EST 2005 ajc
* Require Citadel server version to be at least 6.63
* THIS IS 6.40

Tue Dec 13 14:41:50 EST 2005 ajc
* Don't try to twiddle /etc/inittab on systems that don't have /etc/inittab.

Tue Dec 13 14:27:24 EST 2005 ajc
* chatframeset.html: inserted a missing </body> tag.

Mon Dec 12 12:10:21 EST 2005 ajc
* it.po: updated Italian translation submitted by Gabriele Tassoni

Mon Dec 12 1:40:03 CET 2005 dothebart
* another rework of the locale parser. Hopefully feature complete now.
	
Sun Dec 11 00:03:04 EST 2005 ajc
* Mercilessly ripped out all of the gratuitously complex GNU libintl
  detection m4 crapola and replaced it with some simple autoconf directives
  to detect whether the host system has the correct set of NLS functions for
  supporting per-thread locale.

Sat Dec 10 20:48:40 EST 2005 ajc
* wclib.js: transmit the "no floors expanded" condition to the server.

Sat Dec 10 17:44:51 EST 2005 ajc
* Switched our TinyMCE call to the "advanced" theme.  Also enabled
  the IESpell plugin (when Internet Explorer is in use).

Fri Dec  9 14:40:21 EST 2005 ajc
* Deleting a message from the Trash folder now actually deletes it instead
  of trying to move it to the Trash.  Requires Citadel server 6.63.

Fri Dec  9 13:45:31 EST 2005 ajc
* Slightly more intelligent language detection.

Thu Dec  8 17:23:46 EST 2005 ajc
* Detect the browser language, and use it as the default language selection.

Thu Dec  8 11:48:34 EST 2005 ajc
* Fix "locale leak" on newer Linux systems where gettext() seems to cache
  its translated messages.  textdomain(textdomain(NULL)) clears the cache.

Wed Dec  7 22:22:09 EST 2005 ajc
* Improved the reliability of per-thread locale by unsetting it at the end
  of each transaction.

Wed Dec  7 17:57:57 EST 2005 ajc
* Fixed more missing localization items

Wed Dec  7 13:03:05 EST 2005 ajc
* Per-session locale.  For some reason it doesn't work well.

Wed Dec  7 08:23:31 EST 2005 ajc
* po/it.po: Italian localization submitted by Gabriele Tassoni

Mon Dec  5 18:06:40 EST 2005 ajc
* Upgraded TinyMCE to v2.0.1; CLEAR YOUR CACHE NOW

Mon Dec 5 18:40:03 CET 2005 dothebart
* Use tokenizer function to completely parse accept-lang header.

Mon Dec  5 11:47:20 EST 2005 ajc
* Added in some of the missing localizations

Sat Dec 3 10:28:03 CET 2005 dothebart
* fixed langage detection to work with simple 'de' and no other stuff
* added some translations
	
Fri Dec  2 17:49:32 EST 2005 ajc
* Re-enabled browser language detection.  This will be debugged and finalized.

Fri Dec  2 11:01:30 EST 2005 ajc
* wclib.js: fixed a syntax error

Thu Dec  1 17:46:18 EST 2005 ajc
* which_div_expanded is now persistent across sessions

Thu Dec  1 17:42:48 EST 2005 ajc
* which_div_expanded is now persistent across page loads

Thu Dec  1 17:15:32 EST 2005 ajc
* Clicking on the expanded floor div collapses it.

Thu Dec  1 17:03:15 EST 2005 ajc
* More style changes to the new room list, mainly with regard to font size
  and line breaks.

Thu Dec  1 14:35:09 EST 2005 ajc
* Added icons to the new room list

Thu Dec  1 00:42:01 EST 2005 ajc
* The iconbar roomlist, when selected, is now persistent across page loads
  and even between sessions.  We also cache the list for up to 5 minutes so
  it doesn't have to load from the Citadel server over and over again.

Wed Nov 30 23:59:11 EST 2005 ajc
* Shortened some of the string lengths in struct wcsession.  We really don't
  need all those 4096 byte moby-buffers everywhere.

Tue Nov 29 23:53:33 EST 2005 ajc
* Drag-and-drop move messages is now complete.

Tue Nov 29 23:20:23 EST 2005 ajc
* Completed the JavaScript-detection of room names in the iconbar as drop
  targets.

Mon Nov 28 23:04:13 EST 2005 ajc
* Made the iconbar room list somewhat usable (collapse/expand).  It is not yet
  a drop target, though, which is why we did all this in the first place.

Mon Nov 27 21:28:03 CET 2005 dothebart
* migrate to _GNU_SOURCE and uselocale() to be threadsafe.
	
Sun Nov 27 21:28:03 EST 2005 ajc
* Eliminated the use of tmpnam() to shut up compiler warnings.

Sun Nov 27 18:42:15 CET 2005 dothebart
* Detect locale from Browser Environment

Sun Nov 27 18:42:15 CET 2005 dothebart
* staticaly bind codeset to utf8.

Wed Nov 23 23:32:04 EST 2005 ajc
* Placed a mini roomlist in the iconbar.  This is not in its final form.

Wed Nov 23 16:42:15 CET 2005 dothebart
* added missing german translations
* changed multi line strings with empty string in first line to be searchable
  from real untranslated strings

Wed Nov 23 11:04:24 EST 2005 ajc
* auth.c: localized "User name:" and "Password:" prompts

Tue Nov 22 21:44:15 EST 2005 ajc
* Fixed the unresponsive msgomatic in the bulletin board view.

Tue Nov 22 00:00:46 EST 2005 ajc
* Set up a toggleable iconbar that can switch between the menu and a room
  list.  The room list is not yet implemented, so a simple placeholder is
  there instead.

Mon Nov 21 22:47:17 EST 2005 ajc
* messages.c, webcit.css: message buttons (Reply, ReplyQuoted, etc.) are now
  in a smaller font (new style "msgbuttons" defined in the stylesheet)
* Reply and ReplyQuoted no longer generate an empty "Re:" subject if the
  message being replied to has no subject.

Mon Nov 21 22:30:31 EST 2005 ajc
* create-pot.sh: now creates a new webcit.pot file and automatically merges
  it into all *.po files, allowing an easy way for translators to access
  new strings.
* axdefs[] (Access level definitions) -- now ready for localization.

Mon Nov 21 16:59:43 CET 2005 dothebart
* add some script to wrap the debian package build that does some magic about
  the versioning in the package and the webcit system
* added first try of a package that will install webcit via mod_proxy into
  the debian apache system
* modified package build and postinst script do include subdirectories new
  since tiny_mce was added.
	

Sun Nov 20 22:22:37 EST 2005 ajc
* Moved the definition of INADDR_NONE to webcit.h, where it will be effective
  in all locations where it is needed.  Fixes the build on Solaris 10.

Fri Nov 18 23:55:29 EST 2005 ajc
* Put in some infrastructure for generating and maintaining .po files

Fri Nov 18 23:24:09 EST 2005 ajc
* Threw away most of the gettextize-generated build system in the po/
  directory, and replaced it with a very simple Makefile.in.in instead.

Thu Nov 17 11:32:39 EST 2005 ajc
* More changes to try to get the po/ directory to build properly.  It's still
  not working.  If you want to run WebCit using the current tree, be sure to
  configure with --disable-nls

Tue Nov 17 00:03:20 EST 2005 ajc
* Assorted tweaks to activate the translations...

Tue Nov 15 21:58:09 EST 2005 ajc
* Checked in po/de.po, a German translation submitted by Wilifried Goesgens.
  Now I just have to figure out how to activate it.

Sun Nov 13 23:08:58 EST 2005 ajc
* Added an '-f' command line option to allow WebCit to follow the
  'X-Forwarded-For:' HTTP header, if present. 
* Added missing HTTP headers for /listsub
* Discovered the style -moz-user-select:none and applied it to the mailbox
  summary table, to prevent text select from ruining the appearance of our
  beautiful drag and drop function.
* Strip prepended '/webcit' in requested url's.  This may allow us to handle
  incoming proxy requests from a front end web server.
* Don't require a session cookie for static content.

Thu Nov 10 17:37:32 EST 2005 ajc
* Completed the implementation of a simple drop target for messages.  Right
  now it just drops to trash.  Need to do a folder list drop now.

Wed Nov  9 23:07:44 EST 2005 ajc
* Removed arbitrary upper bound in message select array, after realizing that
  JavaScript arrays don't need to have their size declared.

Tue Nov  8 23:50:01 EST 2005 ajc
* Mailbox view: selected messages are now draggable!!  (Now we just need to
  implement a place to drop them.)

Tue Nov  8 00:44:19 EST 2005 ajc
* Now it resizes on mousemove instead of mouseup.  Very nice animated effect.

Tue Nov  8 00:36:46 EST 2005 ajc
* First cut of message list resize.  It works but it resizes on mouseup.

Mon Nov  7 10:45:18 EST 2005 ajc
* Disable the I-bar cursor when hovering over message summary lines in the
  mailbox view; go with the default pointer instead. 

Sun Nov  6 23:27:21 EST 2005 ajc
* Mailbox summary view -- headers are now ever-present; they do not scroll
  with the table.

Sun Nov  6 22:30:54 EST 2005 ajc
* Changed keypress handling so that it works not only in web browsers, but in
  Internet Explorer as well.

Sun Nov  6 12:26:43 EST 2005 ajc
* Message delete: table row delete is now handled by a script.aculo.us effect
  instead of by just clearing out the innerHTML of the table row div, because
  IE barfs on the latter.

Sat Nov  5 22:53:29 EST 2005 ajc
* Found and removed more absolute URL's.

Sat Nov  5 00:50:25 EST 2005 ajc
* The checkboxes are gone!  Implemented ajax delete of selected messages,
  via either the Delete button or the Delete key.

Fri Nov  4 23:47:23 EST 2005 ajc
* Multi select using ctrl now handles the condition of a message already being
  selected and the user doing ctrl-click to deselect it.

Fri Nov  4 17:04:49 EST 2005 ajc
* Multi select (using the ctrl key) is now working.

Thu Nov  3 23:44:55 EST 2005 ajc
* Removed all of the absolute URL's.

Thu Nov  3 11:11:37 EST 2005 ajc
* Removed the 'mark message as seen' C code (in the mailbox view) because it
  was no longer getting called.  Implemented this in JavaScript using an ajax
  call plus a new WebCit function to perform generic server commands using
  ajax.  Also reinstated the removal of bold font weight for messages
  transitioning from unseen to seen (again, in JavaScript).

Wed Nov  2 23:45:16 EST 2005 ajc
* Mailbox view -- onClick is now implemented by a JavaScript function which
  is defined in wclib.js -- now, it not only handles the Ajax load of the
  message into the preview pane, but it also highlights the table row, and
  remembers the highlighting so it can be turned off when another row is
  selected.  This is if course a prelude to ajaxifying the table...

Wed Nov  2 15:57:37 EST 2005 ajc
* Switched the mailbox summary back to a table.  This is tabular data and it
  ought to be marked up as a table.  We went to fixed width floating div's in
  order to use script.aculo.us 'draggable' but dragging the entire row ended
  up looking like crap, and it didn't appear that we would be able to drag
  outside the source div anyway.  So we're going back to the table.

Wed Nov  2 15:07:21 EST 2005 ajc
* "Read reverse" (or rather, an "oldest to newest / newest to oldest"
  setting) is now selectable in the message board view.

Wed Nov  2 00:10:28 EST 2005 ajc
* Implemented the webcit equivalent of "read reverse" for bbs read mode.
  All we need now is to add the user options to select it.

Tue Nov  1 22:30:15 EST 2005 ajc
* useredit.c: added in the missing "Permission to send Internet mail"
  option for editing a user account.

Mon Oct 31 22:29:39 EST 2005 ajc
* messages.c: the summary line for each message is now a SPAN instead of
  a DIV.  This was done because we needed the SPAN anyway to apply styles,
  and saves some space.

Sun Oct 30 21:58:23 EST 2005 ajc
* summary.c: fixed the date display.

Sun Oct 30 01:40:35 EDT 2005 ajc
* messages.c: the summary line for each message is now a div containing fixed
  width floating spans instead of a table row.  This is being done as part of
  the preparations to ajaxify the presentation of this data.

Thu Oct 27 16:57:38 EDT 2005 ajc
* THIS IS 6.31

Wed Oct 26 16:19:24 EDT 2005 ajc
* Bumped internal version number to 6.31.  Minimum Citadel server required
  is version 6.61.

Wed Oct 26 12:09:20 EDT 2005 ajc
* webcit.c: msgesc() no longer inserts backslashes before every single-quote
  appearing in the quoted or forwarded message.

Mon Oct 24 23:10:30 EDT 2005 ajc
* Mailbox view: deleting messages now moves them to the Trash folder

Mon Oct 24 22:18:25 EDT 2005 ajc
* calendar_view.c: fixed a variable initialization bug that was causing some
  time-specific events to be displayed as all-day events.

Mon Oct 24 11:58:53 EDT 2005 ajc
* List sub/unsub confirmation -- Citadel now wants http:// or https://
  prepended as part of the 'submitted subscribe url' so we are now doing
  that.

Sat Oct 22 01:01:02 EDT 2005 ajc
* More changes required to be able to do embedded message/rfc822 and still be
  able to view the attachments in the embedded submessage.   Yow.
* Brought over the updated MIME parser from the Citadel package.

Fri Oct 21 15:25:49 EDT 2005 ajc
* Handle embedded message/rfc822 submessages, using the new form of MSG4 on
  the Citadel server that can extract these for us.  There is still a bug or
  two in this to be fixed...

Mon Oct 17 11:12:50 EDT 2005 Art Cancro <ajc@uncensored.citadel.org>
* THIS IS 6.30

Sat Oct 15 00:43:17 EDT 2005 Art Cancro <ajc@uncensored.citadel.org>
* Sort messages in reverse date order when no sort preference is set
* When going from non-date sort to date sort, try reverse order first

Sat Oct 15 00:28:35 EDT 2005 Art Cancro <ajc@uncensored.citadel.org>
* Better handling of multiple recipients in reply-all

Thu Oct 13 15:30:08 EDT 2005 Art Cancro <ajc@uncensored.citadel.org>
* <tr> and </tr> tags for each row in a mailbox summary view, are now
  output by display_summarized() instead of by readloop().  This makes the
  code easier to read and refactors it slightly in preparation for some evil
  plans...

Wed Oct 12 23:58:15 EDT 2005 Art Cancro <ajc@uncensored.citadel.org>
* Rooms view -- render properly when empty floors exist
  [fixes bugzilla issue # 156]

Mon Oct 10 23:01:44 EDT 2005 Art Cancro <ajc@uncensored.citadel.org>
* Removed an extraneous reference to 'ThreadSSL' in webserver.c that was
  causing the build to fail on non-SSL systems

Sun Oct  9 00:31:33 EDT 2005 Art Cancro <ajc@uncensored.citadel.org>
* Removed new mail notification from the room banner, and placed it into
  the Mail button on the iconbar instead.  However, this is still broken
  because the server's new mail notification is insufficient for this...

Sun Oct  9 00:12:11 EDT 2005 Art Cancro <ajc@uncensored.citadel.org>
* serv_crypto.c: don't attempt to continue reading/writing an SSL context
  that has already been closed.  Doing so crashes the webserver, which
  some people consider a Bad Thing  :)

Fri Oct  7 23:09:28 EDT 2005 Art Cancro <ajc@uncensored.citadel.org>
* Makefile: change "CVS" to ".svn" to avoid errors during make install

Fri Oct  7 17:37:16 EDT 2005 ajc
* messages.c: fix infinite loop in utf8ify-header

Revision 625.34  2005/10/06 19:34:08  ajc
* GroupDAV locate_message_by_uid() now uses the EUID command on the Citadel
  server.  Fast fast.

Revision 625.33  2005/10/05 17:54:08  error
* Show the ThreadSSL in the debugging logs.

Revision 625.32  2005/09/30 20:57:27  ajc
* Added "Display Name" (or as vCard calls it, "friendly name" or "fn") to
  the vCard editing screen.

Revision 625.31  2005/09/29 15:59:33  ajc
* Finished the "signature" function.

Revision 625.30  2005/09/29 04:10:40  ajc
* sig is done, but need to add proper handling of linebreaks

Revision 625.29  2005/09/29 02:54:17  ajc
* Began implementing the "signature" feature.  It doesn't work yet.

Revision 625.28  2005/09/28 03:29:47  ajc
* Don't display room banner on "Confirm move of message" screen

Revision 625.27  2005/09/28 03:19:13  ajc
* "Reply" and "ReplyAll" now quote the original message, but only when
  it's private mail.
* For non-mail, a "ReplyQuoted" button is now present.
* "Move" and "Delete" are now present for a user's mailbox rooms.
* Improved the <blockquote> style.

Revision 625.26  2005/09/27 02:12:13  ajc
* When clicking on an email address in a vCard to send the person an
  email message, use the display name plus the email address.

Revision 625.25  2005/09/26 21:56:31  ajc
* Offer the [Move] and [Delete] buttons not only for aide/roomaide, but
  also whenever we are in a mailbox room owned by the user.

Revision 625.24  2005/09/26 18:00:51  ajc
* Upgraded TinyMCE to version 2.0RC3.  This fixes a conflict with
  the prototype.js library.

Revision 625.23  2005/09/26 03:10:10  ajc
* Updated "make install" to handle the multi static thing

Revision 625.22  2005/09/26 02:45:06  ajc
* Removed the Kevin Roth rich text editor and replaced it with TinyMCE.

Revision 625.21  2005/09/25 20:58:56  ajc
* Generalized the way we handle static content directories so that we may
  have more than one of them (i.e. not just "static/")

Revision 625.20  2005/09/21 13:25:53  ajc
* The RSS/XML button is temporarily commented out in order to prevent
  users from selecting this possibly unfinished feature.

Revision 625.19  2005/09/21 04:00:53  ajc
* Downloading attachments now gives the browser a better hint as to what
  it should name the file.
* Downloading attachments is now supported even when the MIME part is
  stupidly listed as "inline" rather than "attachment."

Revision 625.18  2005/09/20 21:59:22  ajc
* webcit.c: moved request_method[] out of the global scope (yikes!!!)
* rss.c: removed "const" from function declarations to silence
         a compiler warning

Revision 625.17  2005/09/19 02:56:21  ajc
* Two-pane mail reading now uses Ajax instead of a hidden iframe, and it's
  very crisp and responsive.
* "Print message" function now opens up a new window for the print
  preview.  I just couldn't figure out a way to keep the b0rken IE from
  printing the screen instead of the message.

Revision 625.16  2005/09/19 02:07:17  ajc
* Renamed 'ScriptaculousEffect' back to 'Effect' because there is no
  longer any namespace conflict.

Revision 625.15  2005/09/18 21:47:49  ajc
*** empty log message ***

Revision 625.14  2005/09/18 16:00:14  ajc
* Discovered that Prototype makes it easy to auto-refresh, so I switched
  the wholist and summary refresh code to use that API instead of doing it
  myself.
* Switched all HTTP/1.0 HTTP/1.1.  I don't know if this is going to break
  anything (it shouldn't -- I'm not knowingly depending upon any features
  of HTTP/1.0), but it *fixes* the problem of Internet Exploder caching
  pages even when it's told not to.

Revision 625.13  2005/09/18 15:02:29  ajc
* summary.c: summary screen is now updated using ajax instead of refreshing
  the whole page.  Not only does this look cleaner, but it also has the
  happy side effect of not reloading all of the images.
* webcit.c: new API calls begin_ajax_response() and end_ajax_response() for
  wrapping inner div's
* webcit.c: removed the "refresh30" parameter from output_headers() and
  from all code that calls it.  We don't need it anymore; refreshing the
  entire page is, like, sooooo 2004.  :)

Revision 625.12  2005/09/18 14:30:05  ajc
* Added a "random number" parameter to the wholist ajax refresh request,
  because b0rken MSIE still insists on fetching from its cache even though
  it's been explicitly told not to.

Revision 625.11  2005/09/18 04:04:32  ajc
* Switched the wholist updater to Prototype's AJAX updater, instead of
  using Rico's wrapper around it.  It's actually simpler and doesn't seem
  to require strict XML, which are both wins.
* Removed Rico from the build.

Revision 625.10  2005/09/18 03:15:15  ajc
* Remove spurious "No new messages" message when viewing an
  empty address book.

Revision 625.9  2005/09/18 00:53:15  ajc
* "Reply All" button

Revision 625.8  2005/09/17 16:44:30  ajc
* The JavaScript code to activate the ajax-powered recipient autocompleters
  has been moved to a function in wclib.js (it's still activated from an
  inline script in messages.c)

Revision 625.7  2005/09/17 13:18:05  ajc
* fmt_date.c: changes to "brief" mode.  It now displays time-only if the
  date is today, month/day/time if the date is within the last six months,
  and date-only for anything older.

Revision 625.6  2005/09/17 03:00:06  ajc
* Fixed the autocompletion for CC: and BCC:
* Moved the autocompletion styles into the stylesheet where they belong

Revision 625.5  2005/09/16 04:34:46  ajc
* Initial hack of Cc: and Bcc: support

Revision 625.4  2005/09/16 02:36:01  ajc
* The 'To:' box accepts more characters now
* Removed the border from the new 'XML' button

Revision 625.3  2005/09/16 01:20:00  error
Add Reply and Email links; and an RSS link in the header

Revision 625.2  2005/09/15 21:29:42  ajc
* Made the message list div slightly larger, the preview pane equally
  smaller, and stuck a separator bar in between them that will someday
  be draggable.

Revision 625.1  2005/09/14 03:53:43  ajc
* Autocompletion now fetches candidate addresses using the AUTO server
  command being built for Citadel 6.56

Revision 625.0  2005/09/13 14:02:32  ajc
* THIS IS 6.25

Revision 621.41  2005/09/12 20:57:58  ajc
* Save/Cancel buttons are now at the top *and* bottom of the message
  entry screen.  Evidently some users seem to want this.

Revision 621.40  2005/09/12 19:03:44  ajc
* When forwarding a message, properly escape the quoted headers (especially
  the subject) for insertion into the editor.

Revision 621.39  2005/09/12 18:20:21  ajc
* The "forward" button is now working, and it forwards the attachments.

Revision 621.38  2005/09/12 04:08:05  ajc
* Built an initial version of the "forward message" function.  It works
  perfectly on the message text now, but we cannot consider it finished
  until it also forwards attachments.

Revision 621.37  2005/09/10 03:23:05  ajc
* Determined where to insert a "Forward" button and the functionality it
  implements.  In order to complete this function we will need a
  form-sanitized output mode for read_message().

Revision 621.36  2005/09/09 19:47:29  ajc
* Removed some dead code

Revision 621.34  2005/09/09 04:43:22  ajc
* Checked in a copy of the "script.aculo.us" library by Thomas Fuchs.
  NOTE: I had to search-and-replace "Effect" to "ScriptaculousEffect" in
  all of their files, to avoid a conflict with the name "Effect" in Rico.
* Implemented recipient autocompletion when composing mail, using the
  script.aculo.us drop-down box and an ajax fetch.  Cool!!

Revision 621.33  2005/09/06 14:44:28  ajc
* Altered the logic which determines whether to display a "Post message"
  or "Send message" button on the message entry screen.

Revision 621.32  2005/09/01 03:54:32  ajc
* The "prompt for recipient" screen is now gone.  When the user is posting
  from a room requiring a recipient, a "To:" line now appears above the
  "Subject:" line.  Entering an invalid recipient causes the message entry
  screen to loop back to itself, with the form contents still intact, and
  the ImportantMessage box set to the error message.

Revision 621.31  2005/08/30 04:30:53  ajc
* messages.c: teh b0rken Intarweb Exploder was printing the screen rather
  than the hidden iframe when user selects "Print" message.  Applied a
  workaround.

Revision 621.30  2005/08/23 02:57:04  ajc
* Added some files to the po/ directory, but I really don't know what I'm
  doing here...

Revision 621.29  2005/08/22 21:22:00  ajc
* vcard_edit.c webcit.c webserver.c who.c : i18n
* This should complete the internationalization of the entire WebCit
  package.  Testing must be done, and then of course we must have someone
  do a translation so we can see if this thing works.

Revision 621.28  2005/08/22 20:27:26  ajc
* userlist.c: i18n
* vcard.c: minor change to comments in code

Revision 621.27  2005/08/22 20:21:21  ajc
* useredit.c: i18n

Revision 621.26  2005/08/22 19:26:09  ajc
* subst.c summary.c sysmsgs.c : i18n

Revision 621.25  2005/08/22 19:06:52  ajc
* siteconfig.c: i18n

Revision 621.24  2005/08/22 18:02:24  ajc
* siteconfig.c: began i18n

Revision 621.23  2005/08/22 16:53:11  ajc
* rss.c: i18n

Revision 621.22  2005/08/22 04:33:30  ajc
* paging.c preferences.c roomops.c : i18n
* Also changed various "OK" buttons to labels more descriptive of
  their actual functions.

Revision 621.21  2005/08/22 01:02:42  ajc
* messages.c: finished i18n
* webcit.h: minimum required Citadel server version is now 6.55; this is
  required in order to gain access to the new version of the MSGS command
  that includes a header summary.

Revision 621.20  2005/08/21 05:02:17  ajc
* messages.c: renamed some elements

Revision 621.19  2005/08/20 04:37:50  ajc
* mainmenu.c: i18n
* messages.c: partially i18n

Revision 621.18  2005/08/19 21:46:48  ajc
* inetconf.c, listsub.c, part of mainmenu.c: i18n

Revision 621.17  2005/08/19 16:56:00  ajc
* inetconf.c: partial i18n

Revision 621.16  2005/08/18 22:08:26  ajc
* iconbar.c: i18n

Revision 621.15  2005/08/18 18:33:34  ajc
* calendar_view.c event.c floors.c graphics.c html2html.c iconbar.c: i18n

Revision 621.14  2005/08/18 16:17:25  ajc
* calendar_tools.c: i18n

Revision 621.13  2005/08/18 14:36:54  ajc
* calendar.c: finished preparing strings for i18n
* sysmsgs.c: Save/Cancel buttons now have different element names, so we
  can do a "which element has a nonzero length" check instead of a "what
  is the value of this element" check.  This is vital because the value
  equals the label, and the label will change if the language changes.
  This must be done throughout the system.

Revision 621.12  2005/08/17 22:18:00  ajc
* calendar.c: altered conflict reporting strings for better i18n

Revision 621.11  2005/08/17 17:56:32  ajc
* availability.c: prepared for i18n
* calendar.c: began preparing for i18n

Revision 621.10  2005/08/17 17:44:59  ajc
* auth.c: prepared for internationalization

Revision 621.9  2005/08/17 03:43:20  ajc
* More work to get the gettext stuff working, although I really don't
  know what I'm doing here

Revision 621.8  2005/08/16 20:51:08  ajc
* More gettext/i18n crap

2005-08-16  gettextize  <bug-gnu-gettext@gnu.org>
* configure.in (AC_OUTPUT): Add intl/Makefile,

Revision 621.7  2005/08/16 20:14:25  ajc
* This is an attempt to gettextize the WebCit build.

Revision 621.6  2005/08/15 16:49:02  ajc
* post_mime_to_server() now includes "MIME-Version: 1.0" as required
  by RCC2045.  Some clients look for this.  (Thanks to Shayne for this one)

Revision 621.5  2005/08/12 21:53:31  ajc
* All OS-level includes are now included from webcit.h instead of from
  each individual .c file.  This will keep the build cleaner.

Revision 621.4  2005/08/12 01:01:27  ajc
* The iconbar and summary screen now connect to the user's primary
  groupware rooms using the new macros: _CALENDAR_, _TASKS_, _NOTES_,
  and _CONTACTS_, in order to facilitate those rooms potentially having
  different names on some hosts (such as, perhaps, the same names but in
  different languages).

Revision 621.3  2005/08/11 23:15:03  ajc
* Added debian build directory (submitted by W. Goesgens)

Revision 621.2  2005/08/10 21:55:04  ajc
* siteconfig.c: added support for "instant expunge" and "allow spoofing"
  global configuration options.

Revision 621.1  2005/08/09 01:13:29  ajc
* Mailbox summary view is now generated using the server's
  new "message list with headers summary" mode.

Revision 621.0  2005/08/05 16:28:24  ajc
* THIS IS 6.21

Revision 619.43  2005/08/02 02:38:34  ajc
* new iconv check for both libiconv and built-in iconv

Revision 619.42  2005/08/01 02:28:55  ajc
* Made the ImportantMessage div less obtrusive

Revision 619.41  2005/07/29 16:26:04  ajc
* omit check for gnu libiconv -- the iconv functionality is built into
  most operating systems now.

Revision 619.40  2005/07/29 04:37:29  ajc
* fixed a bug in subject iconv ing

Revision 619.39  2005/07/28 04:06:31  ajc
* "Print" button on each message.  It even uses a hidden iframe to
  eliminate the "here's the printable view" window; the user goes straight
  to the browser's print dialog.  Slick!

Revision 619.38  2005/07/28 03:40:04  ajc
* "Delete selected" button is now "Delete" and it works again

Revision 619.37  2005/07/28 03:16:30  ajc
* Awesome new 2-pane layout with ajax functionality for mailbox view.
* Slick new fade-out effect for "important message" boxes.

Revision 619.36  2005/07/26 04:08:41  ajc
* Previous checkin broke viewing of individual messages while in
  mailbox summary mode.  Fixed.

Revision 619.35  2005/07/26 03:46:27  ajc
* The new sorting options broke the delete-message checkboxes.  Fixed.
* Sorting options are now selectable in either direction, and are
  persistent across sessions.

Revision 619.34  2005/07/25 19:22:30  ajc
* mailbox summary sort by subject/sender/date

Revision 619.33  2005/07/24 04:25:42  ajc
* Replaced the old Citadel logo with a new one
  designed by Lisa Aurigemma (vermilion).

Revision 619.32  2005/07/23 04:18:40  ajc
* New AJAX-based wholist refresh

Revision 619.31  2005/07/22 15:07:29  ajc
* 'whobbs' is now 'who'
* Refactored the wholist code to have its inner div output by a separate
  function, in anticipation of possible ajax functionality being added

Revision 619.30  2005/07/22 04:03:30  ajc
* HTML messages in foreign character sets are now converted to UTF-8 for
  display.

Revision 619.29  2005/07/22 03:40:22  ajc
* Handle display of RFC2047-encoded subjects and senders by converting
  them to UTF-8 (all WebCit pages are output as UTF-8).  Resolves bug #136.

Revision 619.28  2005/07/20 04:26:24  ajc
* Detect libiconv on the host system and link it in if present.
* If libiconv is present, convert foreign charsets to UTF-8 on the fly
  when outputting text/plain messages.  (Still need to do text/html.)

Revision 619.27  2005/07/19 17:05:23  ajc
* Removed the last couple of places where forms were submitted using
  the GET method.  POST is just so technologically cleaner that we should
  use it all the time.
* Fixed a bug in the MIME parser that was causing it to not be 8-bit
  clean.

Revision 619.26  2005/07/19 14:23:04  ajc
* mime_parser.c: don't default Content-type: to text/plain, because when
  an HTTP POST operation is performed, the content type is expected to
  be empty.

Revision 619.25  2005/07/19 04:15:45  ajc
* Brought over the newest version of the MIME parser from Citadel,
  containing an API that supports arbitrary character sets.

Revision 619.24  2005/07/14 04:21:53  ajc
* More intelligent JavaScript to handle the greying out of end date and
  start/end times when "all day event" is selected.

Revision 619.23  2005/07/14 04:02:18  ajc
* Fix bug #147 (date sometimes saved incorrectly for all day events due
  to timezone differences)

Revision 619.22  2005/07/13 16:55:59  ajc
* Use the new icons in more places.

Revision 619.21  2005/07/13 01:59:20  ajc
* Installed the final batch of new icons

Revision 619.20  2005/07/12 22:10:52  ajc
* Icon update

Revision 619.19  2005/06/29 17:55:32  ajc
* Any HTTP method other than GET or POST is now routed directly to the
  GroupDAV code.  This will eventually allow requests such as "PROPFIND /"
  to work.
* GroupDAV requests not beginning with "/groupdav" now automatically have
  that prefix prepended to them.

Revision 619.18  2005/06/29 15:25:00  ajc
* Added an experimental OPTIONS method.  This is not required by GroupDAV,
  but it is an experiment to see whether we can use the same code framework
  to implement other DAV variants in the future.

Revision 619.17  2005/06/29 03:12:28  ajc
* Bumped internal version number to 6.20

Revision 619.16  2005/06/29 03:10:10  ajc
* PROPFIND on an individual item inside a room now works (it simply
  spews the href and etag properties, regardless of what the request
  was).  This is not valid GroupDAV, but Kontact expects this request to
  succeed before an item can be deleted, so we provide a simple response.

Revision 619.15  2005/06/28 14:12:38  ajc
* GroupDAV HTTP header "ETag:" is now output as "etag:" in order to deal with
  a case-sensitivity bug in the Kontact client.

Revision 619.14  2005/06/27 22:15:38  ajc
* Header file adjustments to make it work on FreeBSD

Revision 619.13  2005/06/27 17:38:06  ajc
* HTML pages are now output as "Content-type: text/html; charset=utf-8"
  UTF-8 is going to be the standard character set for the Citadel system.

Revision 619.12  2005/06/24 19:58:02  ajc
* Added a "preferences and settings" screen for each user.
* Removed the javascript date output stuff because it's not granular
  or international enough.
* All dates and times can now be 12 or 24 hours.

Revision 619.11  2005/06/24 15:17:48  ajc
* The date/time stamp of messages are now output using JavaScript's
  toLocaleString() function, observing the browser's locale and timezone
  instead of the web server's.

Revision 619.10  2005/06/23 04:01:59  ajc
* groupdav_main.c: remove double slashes in path name
  (suggested by Johannes Schneider)

Revision 619.9  2005/06/22 03:04:22  ajc
* siteconfig.c: add "auto db log cull" setting now in Citadel 6.52

Revision 619.8  2005/06/21 02:27:37  ajc
* Moved some JavaScript functions out of head.html and into a new wclib.js
  file, which can be included and cached.  This will form the basis for a
  new WebCit JavaScript function library.

Revision 619.7  2005/06/20 20:38:50  ajc
* The main stylesheet is now in a separate file in the static/ directory.
  Something we did recently must have fixed the caching problem, because it's
  only being fetched once now (or "now once" if you're Pennsylvania Dutch).

Revision 619.6  2005/06/20 03:47:44  ajc
* inetconf.c: in save_inetconf(), eliminate sizeof(x) where x is a pointer
  to a heap-allocated buffer rather than a char[xxx].  This fixes a problem
  reported by at least one site where the Internet configuration screen
  was malfunctioning.

Revision 619.5  2005/06/19 04:11:52  ajc
* Integrated the second batch of new icons.

Revision 619.4  2005/06/18 22:58:56  ajc
* Installed the 16x16 "users" icon as favicon.ico, mainly for performance
  reasons -- the browser will cache favicon.ico and won't keep asking for
  it over and over again, eliminating a second HTTP transaction every time
  the user clicks on something.

Revision 619.3  2005/06/18 22:48:32  ajc
*** empty log message ***

Revision 619.2  2005/06/18 22:18:29  ajc
* Replaced the most recent batch of icons with a "better" set which was
  sent by the design house.  I don't know what the difference is, but
  I'm going to assume they're better.

Revision 619.1  2005/06/15 03:56:56  ajc
* Accept ".ifb" as a valid extension for requesting free/busy

Revision 619.0  2005/06/15 01:52:33  ajc
* THIS IS 6.19

Revision 611.15  2005/06/15 01:50:29  ajc
* Bumped the internal version number to 6.19

Revision 611.14  2005/06/14 14:47:48  ajc
* Moved the <td> and </td> in the room icon out of roomops.c and
  into static/roombanner.html, since every room will have an icon now.

Revision 611.13  2005/06/14 03:21:57  ajc
* When no icon is present on the server for a room, display the default
  icon for that room's current view.
* Replace "graphic" with "icon" throughout the system messages.

Revision 611.12  2005/06/14 01:59:43  ajc
* 16x16 icons in the new tree view.  Nice!

Revision 611.11  2005/06/13 22:05:54  ajc
* Finished the initial NanoTree integration.  TODO: use a different icon
  for each node depending on the view set for that room.

Revision 611.10  2005/06/12 22:02:45  ajc
* Began replacing the old, sux0r-prone tree view with NanoTree.
  WARNING: This isn't finished, but I'm committing it anyway because I have
  to move to a different computer.  DON'T RUN THIS.

Revision 611.9  2005/06/12 18:34:50  ajc
* Removed some unreferenced files from the static/ directory.

Revision 611.8  2005/06/12 17:01:00  ajc
* Increase maximum viewable message count from 4096 to 10000
* Summary view now truncates subject to 75 characters, and sender
  to 25 characters (adding an ellipsis...) to keep the display neat & tidy

Revision 611.7  2005/06/12 16:03:11  ajc
* When viewing a mailbox (view == VIEW_MAILBOX), messages are marked as
  seen when they are viewed, and Goto does not automatically mark the
  remaining messages as seen.

Revision 611.6  2005/06/11 22:29:07  ajc
* Integrated the first batch of new icons.

Revision 611.5  2005/06/07 04:31:00  ajc
* Don't compress when HTTP tracing/logging is enabled

Revision 611.4  2005/06/06 23:50:17  ajc
* Made some changes to the calendar/uuid logic to fix a bug that caused
  duplicate entries for an event to appear in some situations

Revision 611.3  2005/06/06 16:20:36  ajc
* GroupDAV URI escape character is now '%' in order to be consistent...

Revision 611.2  2005/06/04 04:07:36  ajc
* Calendar invitations: changed "Accept/Tentative/Decline" buttons to
  links in order to avoid them being in nested forms.

Revision 611.1  2005/06/02 16:10:08  ajc
* tools.c: generated uuid's no longer contain "{" and "}" characters.

Revision 611.0  2005/05/26 04:38:09  ajc
* THIS IS 6.11

Revision 610.9  2005/05/26 04:37:59  ajc
* Updated internal version number to 6.11

Revision 610.8  2005/05/26 04:28:27  ajc
* Applied GroupDAV patches sent in by Johannes Schneider which improve the
  protocol accuracy of xmlns and etag responses.
* Fixed a MIME Content-Type bug which I had inadvertently introduced while
  removing a temporary hack that was put in during KDE 3.4 beta

Revision 610.7  2005/05/24 04:26:47  ajc
* Applied a patch sent by Johannes Schneider for correcting the XML
  namespace presented in the PROPFIND command.

Revision 610.6  2005/05/23 19:30:34  ajc
* Move "enable full text" checkbox configuration to its new location in
  the configuration back end.

Revision 610.5  2005/05/22 16:20:09  ajc
* siteconfig.c: add checkbox for enabling full text index on server

Revision 610.4  2005/05/11 03:00:03  ajc
* webcit.c: fixed a string bug that caused the whole system to not work
* messages.c: fullname only and brief date in summary view, so that it
  doesn't wrap onto two lines quite as often

Revision 610.3  2005/04/11 20:09:33  ajc
* Began an assault on strcpy()

Revision 610.2  2005/04/11 14:45:12  ajc
* Replaced serv_gets() with serv_getln() - which now requires the caller
  to supply the size of the target buffer.

Revision 610.1  2005/04/08 19:36:56  ajc
* Moved to the new string tokenizer API

Revision 610.0  2005/04/04 17:50:04  ajc
* THIS IS 6.10 (unfinished first time install wizard has been disabled)

Revision 603.15  2005/04/04 17:49:31  ajc
* configure.in: fix libical version detection
* bumped internal version number to 6.10

Revision 603.14  2005/03/30 21:44:44  ajc
* Changed the color of the side button bar
* Removed session ID's from wholist display, because they are only
  interesting to computers, not to people.
* Also changed the session ID variable (we still need it internally) from
  a char to an int, because session numbers are big now.

Revision 603.13  2005/03/30 17:27:55  ajc
* serv_crypto.c: made changes to OpenSSL calls ... removed unnecessary
  calls and also enabled SSLv3/TLSv1

Revision 603.12  2005/03/10 05:13:21  ajc
* Created the framework for the "first time setup wizard"

Revision 603.11  2005/03/09 04:08:30  ajc
* Delete room is now confirmed through a JavaScript popup instead of
  a transition page
* New icon for "Tasks."  In order to keep it consistent with the rest of
  the icons, it is ugly.
* Modified page popup style slightly.

Revision 603.10  2005/03/08 04:59:31  ajc
* More attractive display of vCards (hide unknown fields)
* Added "title" and "organization" to vCard display/edit
* Replaced semicolon with comma-space in vCard name display

Revision 603.9  2005/03/07 04:03:28  ajc
* auth.c: shrink the margins on the login screen so the user sees something
  resembling a window.
* Allow editing of address book entries wherever possible.
* Anything that was a (link) is now a [link]

Revision 603.8  2005/03/07 01:45:30  ajc
* Rolled back to the old RTE because the new one doesn't work in Safari.

Revision 603.7  2005/03/05 22:26:26  ajc
* crypto.c: allow use of chained certificates

Revision 603.6  2005/03/05 05:04:34  ajc
* minor html changes

Revision 603.5  2005/03/04 04:21:05  ajc
* When a room is set to the "mailbox" view, "Read new / read all" is
  replaced by "View message list."

Revision 603.4  2005/02/28 04:01:55  ajc
* Updated to the latest version of Kevin Roth's richtext editor.  Had to
  modify it a bit (removal of 'px' suffix, and addition of 'cols=80') to
  allow it to gracefully degrade in Konqueror even when we specify our
  happy 100% width.
* Modified the message entry screen a bit.  Full height just isn't practical
  with all those wacky browsers out there, unfortunately.  Removed most of
  the div's.

Revision 603.3  2005/02/23 05:08:20  ajc
* Better control of HTTP headers which control browser caches.  Static
  objects are getting properly cached now.

Revision 603.2  2005/02/22 05:15:28  ajc
* When the "begin_burst() / end_burst()" semantics are in use, perform
  gzip compression when the client indicates support for it.

Revision 603.1  2005/02/21 23:00:04  ajc
* begin_burst() / end_burst() semantics now apply to all pages which are
  output using the "include_html_head" option of output_headers() (which
  is nearly all of them).  This should speed up the network considerably,
  and also pave the way for another attempt at adding zlib compression
  back in.

Revision 603.0  2005/02/21 22:00:13  ajc
* THIS IS 6.03

Revision 602.10  2005/02/21 21:57:55  ajc
* Various debugging type of everythingism to help chat mode to work.

Revision 602.9  2005/02/21 04:47:41  ajc
* When creating rooms:
* 1. Selecting a view other than "Bulletin Board" causes the room access
*    type to default to "private mailbox"
* 2. When the room access type changes to "private mailbox," the floor
*    selector is greyed out because it is irrelevant.

Revision 602.8  2005/02/20 06:48:30  ajc
* View-o-matic now has "View as: " before it.  "Messages" has been changed
  to "Bulletin Board" and "Summary" has been changed to "Mailbox Summary"
* The View-o-matic is now styled to be smaller and color-matched to the
  banner box it lives in.
* Removed "Summary" from message range selector.  It is redundant.

Revision 602.7  2005/02/20 06:27:53  ajc
* Switched the Reply/Move/Delete buttons back to ordinary links, because
  the nested forms were causing the bottom part of the outer form to stop
  working (message range selector went dead).  Thanks to triLcat for
  reporting this.

Revision 602.6  2005/02/19 06:01:14  ajc
* The previous <div style=\"margin-right:1px\"> has been replaced by a
  named div in the stylesheet.  This allows us to perform a vile, sleazy
  hack to keep IE6 from exhibiting its horizontal scrollbar bug.  There
  will unfortunately always be a right margin in IE6, but there
  doesn't appear to be any easy workaround.

Revision 602.5  2005/02/19 05:22:00  ajc
* Replaced all the "centered 99% tables" with 100% width tables wrapped
  inside a div with margin-right:1px to remove the horizontal scrollbar
  in Gecko without creating whitespace.  IE6's problem is much more
  serious and will require dropping a nuclear bomb on Redmond to fix.

Revision 602.4  2005/02/18 05:09:52  ajc
* Moved the room access control screen into a tab on the edit room menu

Revision 602.3  2005/02/17 04:48:26  ajc
* After setup is complete, tell them how to log in.
* Don't allow the creation of accounts with blank passwords.
* Don't allow users to change to a blank password.
* Fixed the positioning of a few more screens that accidentally got
  partially hidden underneath the iconbar.
* Boldfaced the "Password changed." and other prompts.
* Removed the unreadable blue-on-blue links in the calendar day
  view.  They're redundant anyway, now: "Add new calendar event" and
  "month view" are both in the banner bar.
* "New messages / All messages" are now "Read new messages / Read all
  messages"
* "Save message" button is now "Post message" for public room posts,
  and "Send message" for email.
* "Message has been posted" is now "Message has been sent" for email.
* Swapped positions of "Add users" and "Edit users" boxes.
* vCard editor: "Other Internet email addresses" is now "aliases"
* Renamed the "Users" button to "Who is online?"

Revision 602.2  2005/02/16 05:40:31  ajc
* More display fixes

Revision 602.1  2005/02/16 05:22:22  ajc
* inetconf.c: fixed memory management problem that was causing all
  the inetconf to get discarded during edit on IBM POWER5

Revision 602.0  2005/02/15 05:23:10  ajc
* THIS IS 6.02

Revision 601.3  2005/02/15 05:20:44  ajc
* Fixed an HTTP output error for static data which was causing images
  to display improperly in Konqueror
* Changed most of the beginbox_nt boxes to centered tables with 99%
  width, to avoid the mysterious horizontal scrollbar

Revision 601.2  2005/02/14 04:57:23  ajc
* Started changing some of the top-level tables from 100% width to 99%
  width in order to keep the b0rken CSS box-model from displaying a
  horizontal scroll bar when it shouldn't.  Lose, lose, lose.

Revision 601.1  2005/02/13 04:22:31  ajc
* Network configuration screen: add IMAPS, POP3S, and SMTPS ports

Revision 601.0  2005/02/12 04:23:43  ajc
* THIS IS 6.01

Revision 528.48  2005/02/11 03:35:57  ajc
* useredit.c: added an "Delete user" button, because it was unintuitive
  to tell people "Delete a user by setting their access level to 0"

Revision 528.47  2005/02/09 04:37:32  ajc
* More GroupDAV fixes and tuning.

Revision 528.46  2005/02/07 22:02:00  ajc
* groupdav_propfind.c: output all XML on a single line, with no linebreaks,
  and no whitespace between tags.  We have discovered that doing otherwise
  will break certain clients.

Revision 528.45  2005/02/06 03:59:33  ajc
* Added some HTTP Date: header output

Revision 528.44  2005/02/05 22:58:46  ajc
* All GroupDAV HTTP output is now \r\n instead of \n terminated.

Revision 528.43  2005/02/05 08:36:13  ajc
* Added an everything-buffering thingi so we can do Content-length:

Revision 528.42  2005/02/05 04:16:01  ajc
* Cleanup of new message range view-o-matic
* GroupDAV GET operations now only send the Content-type: and Date:
  headers.  All the others are irrelevant.

Revision 528.41  2005/02/04 19:19:23  ajc
* Message reading range selection is now a drop-down box.

Revision 528.40  2005/02/04 17:22:18  ajc
* Cleaned up the rcs/cvs Id tags and leading comments at the top of some files

Revision 528.39  2005/02/04 03:43:31  ajc
* fixed the tasks view in the summary screen

Revision 528.38  2005/02/03 05:13:57  ajc
* More tuning for GroupDAV compliance.

Revision 528.37  2005/02/03 04:38:40  ajc
* VTODO components need to be encapsulated inside VCALENDAR components,
  just like we do with VEVENT components.  There's a bunch of software
  (including the beforesave hook on our own Citadel server) that expects
  this encapsulation.

Revision 528.36  2005/02/02 23:25:21  ajc
* Encode GroupDAV uid's using more concise string escaping, because the
  old way was making KOrganizer choke.

Revision 528.35  2005/02/02 04:13:36  ajc
* Debugged the GroupDAV service with KOrganizer.  It's mostly working now.

Revision 528.34  2005/02/01 23:15:50  ajc
* Completed GroupDAV PUT.  Untested.

Revision 528.33  2005/02/01 19:52:29  ajc
* Bumped the internal version number to 6.01
* Set the minimum required Citadel version to 6.40, because we need the
  automatic fill-in-missing-uid groupware stuff, and the new ENT0 semantics
  with confirmation.

Revision 528.32  2005/02/01 15:15:40  ajc
* Better purging of not-logged-in GroupDAV sessions

Revision 528.31  2005/02/01 14:55:12  ajc
* Reworked the PROPFIND xml output based on an example transaction
  supplied by Reinhold Kainhofer.  Groupware folder enumeration works
  properly in Kontact now.

Revision 528.30  2005/02/01 03:49:09  ajc
* Completed "folder list" PROPFIND, now listing all rooms set to a
  calendar, tasks, or address view, using the GroupDAV properties.

Revision 528.29  2005/02/01 02:28:32  ajc
* "time(NULL) mod 60" doesn't work for some reason, so it has been removed.
  When defaulting a new event date/time to now, set the seconds to zero
  manually.

Revision 528.28  2005/01/31 23:31:26  ajc
* Initial attempt at GroupDAV PROPFIND for folder enumeration.  Hardcoded
  to only show the Calendar> room.  It kinda-sorta works with KOrganizer.

Revision 528.27  2005/01/31 16:24:47  ajc
* iconbar is now a happy css hovery lightupy div thing

Revision 528.26  2005/01/29 03:59:25  ajc
* Implemented the GroupDAV DELETE method.

Revision 528.25  2005/01/28 05:25:43  ajc
* iconbar no longer uses the beginbox/endbox semantics, but instead lives
  directly inside the iconbar div.

Revision 528.24  2005/01/28 05:13:02  ajc
* GroupDAV object URL's are now based on the EUID of a message (which is
  derived from the UID of the groupware object itself) instead of the
  message number.  This was done in order to conform to GroupDAV's
  requirement that the URL cannot change after an object is updated.
* The ETag of a GroupDAV object is still the message number, and in fact
  doing so meets that requirement perfectly.

Revision 528.23  2005/01/26 18:15:34  ajc
* PROPFIND now outputs fully qualified URL's

Revision 528.22  2005/01/26 18:02:22  ajc
* Initial implementation of GroupDAV PROPFIND

Revision 528.21  2005/01/26 16:28:23  ajc
* Output ETags in double quotes to conform with the new GroupDAV draft.
* Output HTTP Server: header in GroupDAV transactions
* Server: header now displays both WebCit and Citadel versions
* Added groupdav_common_headers() to output HTTP headers common to all
  GroupDAV transactions (Connection: close, Server: WebCit, etc.)

Revision 528.20  2005/01/25 19:51:04  ajc
* Accept escaped characters in GroupDAV GET URL's

Revision 528.19  2005/01/25 04:17:20  ajc
* Implemented the Groupdav GET method, more or less in its final form
  (still need to fix the room/folder naming semantics)

Revision 528.18  2005/01/25 03:12:27  ajc
* Completed HTTP "Basic" authentication, and a stub function for the
  main entry point for GroupDAV functions.

Revision 528.17  2005/01/24 03:37:48  ajc
* Began laying the groundwork for http-authenticated GroupDAV sessions.

Revision 528.16  2005/01/22 22:50:51  ajc
* removed descriptions in non-main menus

Revision 528.15  2005/01/20 21:24:27  ajc
* When viewing a calendar room, the "Read all messages" link in the
  room banner has been replaced by "Day view" and "Month view" links.
  (I have also imported icons for week and year views, in case we add
  these later.)

Revision 528.14  2005/01/20 16:13:56  ajc
* Added in a bunch of stupid JavaScript to allow the instant message
  window to be dismissed.

Revision 528.13  2005/01/20 04:10:41  ajc
* Cleaned up a bunch of unused cruft from the old layout
* Instant messages are now displayed in a div that layers itself
  over the rest of the site.  It would be nice if we could figure out
  a way to make a clickable "hide" box...

Revision 528.12  2005/01/17 04:38:14  ajc
* Navbar is now dynamic, in an attempt to make only the relevant controls
  appear on any given page.

Revision 528.11  2005/01/15 07:19:08  ajc
* Removed the fixed pixel width from the tree view room list so it doesn't
  wrap around in an ugly way on aIEeeee.

Revision 528.10  2005/01/15 05:26:27  ajc
* Message entry window is now somewhat full screen.

Revision 528.9  2005/01/14 21:03:17  ajc
* A few logging hacks

Revision 528.8  2005/01/14 15:00:51  ajc
* Placed the navbar into the room banner, at least in its temporary form.

Revision 528.7  2005/01/14 04:53:54  ajc
*** empty log message ***

Revision 528.6  2005/01/14 04:53:12  ajc
* Got the three-pane model working not only with web browsers, but also
  with the disgusting abomination called Internet Explorer.

Revision 528.5  2005/01/13 18:38:08  ajc
* Insert a newline between </div> and <div id="text">

Revision 528.4  2005/01/11 16:20:18  ajc
* Switching doctype from XHTML to HTML 4.01 STRICT, because nothing handles
  XHTML properly.

Revision 528.3  2005/01/11 05:05:08  ajc
* *** HUGE CHANGES ***   *** WARNING: NOT FULLY FUNCTIONAL ***
* Ripped things apart in a big way.  The frameset is gone (except for
  chat, for which we'll probably keep frames).  Iconbar and banner are
  now done using CSS and <div> tags.
* Room read/enter/goto controls are currently missing.  Stay tuned.
* I am in the process of rewriting all of the markup as valid XHTML.

Revision 528.2  2004/12/29 22:08:08  ajc
* roomops.c: provide a way to create room shares with a mapping to an
  alternate room name on the other end.

Revision 528.1  2004/12/29 17:28:09  ajc
* roomops.c: when adding/removing nodes in the 'Sharing' tab, don't go
  all corrupty-whatever when a remote room name mapping is found.  Display
  the mapping and preserve it across share/unshare operations.

Revision 528.0  2004/12/28 03:58:34  ajc
* THIS IS 5.28

Revision 527.1  2004/12/28 03:58:24  ajc
* Corrected overly-escaped reply-to addresses in "reply" button
* Repaired toggling of self-service account creation in admin screen
* Bumped internal version number to 5.28

Revision 527.0  2004/12/07 04:41:37  ajc
* THIS IS 5.27

Revision 526.1  2004/12/07 04:41:02  ajc
* Finally tracked down the WC->vars heap corruption issue (for real this
  time).  We now call clear_local_substs() at the end of each HTTP
  transaction, whether we need to or not, instead of calling it whenever
  we're done with something we wanted session variables for.
* Finally tracked down the years-long "misplaced '(edit)' link" bug, by
  copying serv_info->serv_pid to WC->ctdl_pid at the time it's loaded,
  preventing it from getting clobbered by another session.
* Bumped internal version number to 5.27

Revision 526.0  2004/12/01 21:35:56  ajc
* THIS IS 5.26

Revision 525.4  2004/12/01 21:35:44  ajc
* Changed internal version number to 5.26

Revision 525.3  2004/12/01 21:34:17  ajc
* Numerous memory management bugfixes.

Revision 525.2  2004/12/01 16:48:24  ajc
* tools.c: don't crash when striplt() is called with a zero-length string

Revision 525.1  2004/11/12 18:02:36  ajc
* Updated the richtext editor (new version from Kevin Roth's site)

Revision 525.0  2004/11/03 20:21:10  ajc
* THIS IS 5.25

Revision 524.7  2004/11/03 20:21:02  ajc
* Changed internal version number to 5.25

Revision 524.6  2004/10/20 02:41:41  ajc
* New "notes" icon
* Added the notes room to the icon bar
* Set up an initial implementation of Notes view.  Attractive enough to
  publish, but read-only.  Needs a note editor.

Revision 524.5  2004/10/15 03:10:24  ajc
* Calendar objects UID now generated by generate_uuid() which creates
  pseudo-DCE-ish UUID's.

Revision 524.4  2004/10/05 01:59:31  ajc
* localtime_r() fixes

Revision 524.3  2004/10/03 02:56:35  ajc
* Added a pthread_attr_destroy() in the appropriate place (thanks fleeb!)

Revision 524.2  2004/10/01 16:23:23  ajc
* Set up framework for "notes" view, and added a skeleton function for
  the actual display.

Revision 524.1  2004/09/30 03:44:01  ajc
* fix line width break problem in chat

Revision 524.0  2004/09/28 16:12:44  ajc
* THIS IS 5.24

Revision 523.12  2004/09/28 16:12:30  ajc
* Prepare for 5.24 release

Revision 523.11  2004/09/27 02:17:47  ajc
* messages.c: fix build problem on non-calendar-enabled installations
* floors.c: fix a warning message

Revision 523.10  2004/09/25 03:34:21  ajc
* summary.c: Fixed a calling syntax problem

Revision 523.9  2004/09/25 03:18:43  ajc
* small stylesheet fix

Revision 523.8  2004/09/24 04:21:41  ajc
* Fixed display bug for room list mode when we dropped down multiple
  sublevels at once (such as, from 3 to 1 instead of from 2 to 1)

Revision 523.7  2004/09/24 04:08:25  ajc
* Put our <SPAN> tags back in to denote floors, rooms with new msgs, and
  rooms without new msgs

Revision 523.6  2004/09/24 04:04:34  ajc
* "folders view" of room list now uses Dave Lindquist's "menuExpandable3"
  tree view.

Revision 523.5  2004/09/23 03:21:10  ajc
* roomops.c: "folders" view of rooms is an actual Unnumbered List now.

Revision 523.4  2004/09/16 02:42:37  ajc
* Set default view of new rooms during CRE8 command instead of afterwards

Revision 523.3  2004/09/15 03:08:50  ajc
* Support config of seaperate MSA port in Citadel 6.26

Revision 523.2  2004/09/10 03:49:17  ajc
* Added 'dialog' mode to setup

Revision 523.1  2004/08/31 20:31:01  ajc
* When saving VTODO (tasks), insert a UID if none is already present.  Also
  increment the sequence, or insert one if none is already present.

Revision 523.0  2004/08/31 03:02:37  ajc
* THIS IS 5.23

Revision 522.30  2004/08/31 03:02:28  ajc
* Changed internal version number to 5.23

Revision 522.29  2004/08/27 02:40:06  ajc
* Ditched the graphical buttons because CSS can do the same thing faster.

Revision 522.28  2004/08/18 03:16:12  ajc
* 'move' and 'delete' buttons only show when allowed to do those things

Revision 522.27  2004/08/18 02:10:17  ajc
* Reply/Move/Delete buttons are now images, because system-native buttons
  were too big and ugly.

Revision 522.26  2004/08/11 17:24:57  ajc
* static/iconbar.html: removed.
* Updated the "powered by citadel" graphic

Revision 522.25  2004/08/11 03:49:15  ajc
* Replaced all instances of the name "Citadel/UX" with "Citadel"
* Installed the "simple logo" in the iconbar

Revision 522.24  2004/08/09 03:11:20  ajc
* Changed DOCTYPE to HTML 3.2 because that's really what it resembles

Revision 522.23  2004/08/05 21:32:17  ajc
* Reply/Move/Delete are now buttons instead of links.  This should enable
  us to add some JavaScript magic for "Reply quoted" ...

Revision 522.22  2004/08/05 02:47:21  ajc
* Removed the "pull_quote" style and used the <BLOCKQUOTE> tag instead.  It
  has a more predictable and attractive behavior, and can still be
  overridden in the style sheet if the site operator wants to.

Revision 522.21  2004/08/04 03:52:23  ajc
* Tasks view is now pretty.
* Tasks view now displays date due for each task.
* Tasks view is now sorted by date due.
* Tasks view now displays overdue tasks in red.

Revision 522.20  2004/08/03 03:55:37  ajc
* Tasks view now uses the same buffer/dump logic as the calendar views, so
  we can sort them by due date and do a prettier display.  (Only the logic is
  changed so far.  The prettier display is forthcoming.)

Revision 522.19  2004/07/21 02:57:09  ajc
* Internet Configuration screen looks a little neater now

Revision 522.18  2004/07/21 02:45:15  ajc
* Completed the "Internet Configuration" screen

Revision 522.17  2004/07/16 19:13:37  ajc
*** empty log message ***

Revision 522.16  2004/07/16 19:13:10  ajc
* tools.c: display 12:00 as 12pm, not 12am

Revision 522.15  2004/07/16 03:14:03  ajc
* more work on inetconf screen

Revision 522.14  2004/07/16 02:50:00  ajc
* useredit.c: put a pretty box around user editing

Revision 522.13  2004/07/13 03:25:08  ajc
* inetconf.c: added.  Not finished yet.

Revision 522.12  2004/07/10 03:10:19  ajc
* Completed web screens for THE DREADED AUTO-PURGER by adding room and
  floor level configurations.
* Put a space between OK and CANCEL buttons anywhere in the system where
  there wasn't one.
* Some more of the room config/admin screens now return to themselves
  with a "ok, you did that" message when OK is pressed, instead of dropping
  out to the main menu.

Revision 522.11  2004/07/08 03:03:01  ajc
* Added global settings for THE DREADED AUTO-PURGER to the site-wide
  configuration (public rooms default and mailboxes default).  Still need
  to add floor and room policy screens.

Revision 522.10  2004/07/02 03:28:08  ajc
* Much-improved alphabet tabs for Address Book view.  Now divides the
  total number of names by (names per page, currently 60) and sets up
  that many tabs, with proper [Aaa-Bbb] labels on them.

Revision 522.9  2004/07/02 03:26:06  ajc
*** empty log message ***

Revision 522.8  2004/07/01 02:40:40  ajc
* Clicking "Enter a message" in a groupware room now automatically calls
  the correct editor for the type of objects in the room (message, calendar
  event, task, address book entry)

Revision 522.7  2004/06/29 17:21:25  ajc
* Removed the word "room" in a few locations, as part of our push towards
  not looking like a BBS when running in groupware mode

Revision 522.6  2004/06/29 00:37:02  ajc
* Made some fonts bigger because users were complaining...

Revision 522.5  2004/06/27 03:02:05  ajc
* Summary view -- always view ALL messages
* Summary view -- new messages are in boldface

Revision 522.4  2004/06/24 20:42:14  ajc
* Added the "server ip address" Citadel config option
* Site config: added "Changes will not take effect until..." language
  to relevant screens

Revision 522.3  2004/06/24 14:50:35  ajc
* Added the ability to listen on a single IP address instead of all addresses.

Revision 522.2  2004/06/22 02:21:56  ajc
* Minor UI tweaks

Revision 522.1  2004/06/21 15:00:52  ajc
* minor CSS changes

Revision 522.0  2004/06/19 03:21:35  ajc
* THIS IS 5.22

Revision 521.10  2004/06/19 03:11:07  ajc
* Instead of a crufty "the topmost Internet email address will be used
  for outgoing email" explanation, separated it into "Primary Internet
  email address" and "Other email addresses" boxes.

Revision 521.9  2004/06/19 02:42:12  ajc
* Removed the "aides access to mailboxes" config option, which is no longer
  part of the Citadel system.

Revision 521.8  2004/06/16 02:07:22  ajc
* Removed a couple of lines of debugging code leftover from last night

Revision 521.7  2004/06/15 03:06:11  ajc
* Bumped internal version number to 5.22
* Use new fast headers-only-no-mime fetch mode in Citadel for
  message summaries

Revision 521.6  2004/06/15 02:30:21  ajc
* Honor "maxmsgs" even when viewing a mailbox in summary mode

Revision 521.5  2004/06/12 04:26:38  ajc
* Fixed some garbled output resulting from turning things that look like
  links into links

Revision 521.4  2004/06/11 16:09:36  ajc
* Moved the room graphic to the left of the room name in the banner, to
  make it more consistent with the rest of the site.
* Reduced the size of the font in the iconbar

Revision 521.3  2004/06/11 03:15:08  ajc
* When "Add" is clicked without specifying an upload filename, resume
  composition instead of aborting the post.
* Add attachments to messages in forward order, not reverse order

Revision 521.2  2004/06/10 03:08:48  ajc
* Improved the appearance of tabs in the room config screen

Revision 521.1  2004/06/10 02:58:55  ajc
* Made all the title boxes the same background color.  The old scheme was
  cute but not professional looking.

Revision 521.0  2004/06/06 19:53:25  ajc
* THIS IS 5.21

Revision 510.15  2004/06/06 19:32:15  ajc
* Cleaned up a couple of FIXME's sitting around in the code
* Altered the conditions under which stray http://... strings are
  automatically turned into links, to prevent that logic from
  transforming IMG tags into gibberish.
* Set internal version number to 5.21

Revision 510.14  2004/06/04 02:29:07  ajc
* Fixed bug in "validate new users" screen (thanks Campy)

Revision 510.13  2004/06/03 03:21:22  ajc
* "Reply" button now carries the message subject into the reply.

Revision 510.12  2004/06/02 02:07:54  ajc
* setup.c: updated the setup script to configure two /etc/inittab entries,
  one for http and one for https.

Revision 510.11  2004/06/01 21:46:47  ajc
* crypto.c: when an SSL connection errors out (and closes) unexpectedly
  during a read or write operation, do not attempt to finish the operation
  unencrypted like we do in Citadel.  Here in WebCit land it only causes
  the server to segfault.

Revision 510.10  2004/06/01 19:01:22  ajc
* netconf.c: widened some of the text entry fields
* webcit.h: bumped up the internal version number to 5.20

Revision 510.9  2004/06/01 18:44:20  ajc
* Return to the old command-line usage (-s for https, service is either
  http or https but not both)

Revision 510.8  2004/06/01 03:32:28  ajc
* Add "permanent room" setting to room edit screen
* create room -- allow longer strings

Revision 510.7  2004/06/01 00:36:43  ajc
* Hmmph.  Do the session cookie as hex instead of base64.  There really
  are some characters in the base64 set that make HTTP do nasty things.

Revision 510.6  2004/05/31 21:43:27  ajc
* Added "|END" to the session cookie before base64-ing it.  This fixes a
  problem with certain room names causing the webserver to freak out and
  break embedded images and stuff.  I don't know why.

Revision 510.5  2004/05/31 20:34:11  ajc
* Message entry using Kevin Roth's excellent cross-platform richtext
  editing script.

Revision 510.4  2004/05/31 15:54:13  ajc
* "text" and "HTML" options for message entry.

Revision 510.3  2004/05/29 03:31:48  ajc
* tighten up the space between icons in the iconbar

Revision 510.2  2004/05/28 20:24:53  ajc
* Cosmetic changes

Revision 510.1  2004/05/24 03:02:38  ajc
* CSS change to make folder names stand out more in the "Folder View"

Revision 510.0  2004/04/30 04:08:58  ajc
* THIS IS 5.10

Revision 506.13  2004/04/30 04:08:47  ajc
* Changed internal version number to 5.10
* Updated documentation for the new HTTPS service

Revision 506.12  2004/04/27 03:21:36  ajc
* Prompt for HTTPS port number during setup.  We may make this optional.

Revision 506.11  2004/04/27 03:16:31  ajc
* When running on the same host as Citadel, if no key/cert are found,
  symlink to Citadel's if possible.
* One server binary now forks to start both http and https servers.

Revision 506.10  2004/04/21 03:43:39  ajc
* Completed remaining SSL fixes.  Works in Moz, aIEeee, Konq; self-signed
  certs are also no longer invalid.

Revision 506.9  2004/04/21 02:25:13  ajc
* Replaced ctdl_install_certificate() with convenience functions found
  in the OpenSSL library.

Revision 506.8  2004/04/21 02:19:41  ajc
* Got HTTPS to work with Mozilla (by twiddling stuff that I still don't
  understand, but read at http://www.informit.com/articles/article.asp?p=22078
  ).  Still doesn't work with Internet Monopolizer, though.

Revision 506.7  2004/04/20 02:32:44  ajc
* Allow setup to run seamlessly from within the Citadel Ridiculously
  Easy Installer by observing the values of environment variables
  CITADEL_INSTALLER, CITADEL, and WEBCIT.

Revision 506.6  2004/04/20 02:02:50  ajc
* "make install"

Revision 506.5  2004/04/16 03:14:06  ajc
* Minor fix for previous checkin

Revision 506.4  2004/04/16 02:59:01  ajc
* Completed SSL support.  Still doesn't work with all browsers... gotta
  figure out why

Revision 506.3  2004/04/15 03:57:00  ajc
* Brought over the SSL/TLS stuff from Citadel.  I think it's complete but
  it has a crashy crashy bug in it.  Don't use it yet.

Revision 506.2  2004/04/13 19:41:36  ajc
* GET /freebusy/user.vcf *and* /freebusy/user.vfb now both work.
  (freebusy data fetch for anonymous Kolab type clients)

Revision 506.1  2004/04/10 04:32:59  ajc
* Fixed some version and copyright date oopses

Revision 506.0  2004/04/10 04:29:30  ajc
* THIS IS 5.06

Revision 505.22  2004/04/10 04:29:20  ajc
* Changed internal version number to 5.06

Revision 505.21  2004/03/29 04:30:20  ajc
* configure.in, Makefile.in: handle $LDFLAGS

Revision 505.20  2004/03/20 05:03:14  ajc
* Original startup thread becomes a worker thread after initialization.
  Doing otherwise turns it into a zombie (at least on Linux) and possibly
  leads to other problems
* Filter out NOOP's received in chat

Revision 505.19  2004/03/18 04:32:24  ajc
* Removed the language in README.TXT which told everyone that chat wouldn't
  work with a non-local Citadel server, because that's no longer true.
* Removed the old chat applet from the static/ directory

Revision 505.18  2004/03/18 04:00:44  ajc
* Rounded web boxes now look correct in all browsers.

Revision 505.17  2004/03/17 18:25:31  ajc
* When creating a new user, auto-chain to the "edit user configuration"
  screen, and subsequently auto-chain to the "edit address book entry"
  screen.  This creates a nice sensible workflow.

Revision 505.16  2004/03/15 22:47:09  ajc
* Prettied up the chat window a little more.

Revision 505.15  2004/03/15 04:27:44  ajc
* Chat now appears in a separate window
* Use regular frames instead of IFRAMEs for chat
* Display user's own chat text in bold+italic
* Added a "List Users" button

Revision 505.14  2004/03/09 20:45:45  error
* Add a Linux Software Map file

Revision 505.13  2004/03/07 22:04:32  ajc
* Fix the current view not being set to the default view for the creator
  of a room.

Revision 505.12  2004/03/07 21:31:17  ajc
* serv_read() now zeroes out the supplied buffer (with the supplied
  length) if a server read fails.  This causes serv_gets() to return
  instead of looping endlessly.  Fixes chat problem found on linux-ppc.

Revision 505.11  2004/03/03 05:21:36  ajc
* Made the chat screen totally kick-ass sweet.  The flickering reload
  i-frame is now tiny and hidden, and it *appends* new chat data to
  the viewable window using JavaScript.  No flickering + scrollback!
* Added a help button to the chat screen.

Revision 505.10  2004/02/29 22:52:15  ajc
* Close and clear (set to -1) server socket handle when socket errors are
  detected.  Fixes a chat problem reported by Winzlo.

Revision 505.9  2004/02/29 05:34:25  ajc
* Display the Chat menu option as "Chat with other users in <roomname>"

Revision 505.8  2004/02/27 05:04:38  ajc
* fix frameset bug in page popups

Revision 505.7  2004/02/26 04:08:56  ajc
* Fixed a problem that made WebCit go to the "no cookies" screen instead
  of the logout banner.
* Ford's latest stupid room has a name with more than 64 characters, and
  we still had a 64-byte room name in the march_list struct.  ooooops...

Revision 505.6  2004/02/26 03:07:26  ajc
* Put the /favicon.ico --> /static/favicon.ico hack back in.  Why not?

Revision 505.5  2004/02/25 23:10:28  ajc
* Allow "/do_logout" as a no-frames page

Revision 505.4  2004/02/25 23:00:21  ajc
* Changed the favicon support to LINK tags in the HEAD of static stuff,
  to make life easier.  (Thanks to prosthetik for this)

Revision 505.3  2004/02/25 15:20:11  ajc
* Support for favicon.ico in the static/ directory

Revision 505.2  2004/02/24 04:06:42  ajc
* Changed the colors slightly in chat screen

Revision 505.1  2004/02/20 06:07:06  ajc
* Replaced the Java chat with a new system based on IFRAME's and JavaScript

Revision 505.0  2004/02/19 03:32:50  ajc
* THIS IS 5.05

Revision 504.7  2004/02/19 03:32:38  ajc
* Changed the internal version number to 5.05
* Completed the frames fix

Revision 504.6  2004/02/18 20:08:29  ajc
* Fixed the frameset force reload logic.  Now it does the whole frameset
  without displaying an error in the main frame.

Revision 504.5  2004/02/18 19:17:51  ajc
* Force reload of frameset if someone tries to escape it.  Not perfect
  but it mostly works at this poing.

Revision 504.4  2004/02/17 03:37:11  ajc
* Indicate to Citadel that we want Server Generated Invitations when
  calendar events are saved.  (No longer the default in Citadel server.)

Revision 504.3  2004/02/09 04:49:32  ajc
* Prepare for a way to avoid falling out of the main frameset

Revision 504.2  2004/02/09 03:37:57  ajc
* Changed the thread pool management algorithm.  Detecting idle time between
  socket accepts was not working reliably on all systems, so we now follow
  the same algorithm as the Citadel server (spawn more threads when number
  of sessions < number of threads, but keep constrained to pre-defined
  minimum and maximum thread count)

Revision 504.1  2004/02/03 03:09:51  ajc
* THIS IS 5.04

Revision 503.0  2004/01/28 04:31:31  ajc
* THIS IS 5.03

Revision 502.4  2004/01/28 04:30:48  ajc
* Create Room can now offer calendar and address book rooms

Revision 502.3  2004/01/17 21:25:30  ajc
* Add 'base DN' and 'bind DN' and 'bind DN password' to siteconfig
* Split the config for LDAP Connector into its own panel

Revision 502.2  2004/01/17 04:32:54  ajc
* Add site config options for Citadel servers which support LDAP

Revision 502.1  2003/10/24 02:50:19  ajc
* Clicking "Enter Message" in a room with an Address Book view opens
  a blank vCard entry screen.

Revision 502.0  2003/10/23 03:16:50  ajc
* THIS IS 5.02

Revision 501.2  2003/10/23 03:07:54  ajc
* event.c: Found and removed another unquoted multi-line string literal
* webcit.h: changed an #ifdef HAVE_ICAL_H
  to #ifdef WEBCIT_WITH_CALENDAR_SERVICE to avoid false positives

Revision 501.1  2003/10/22 01:42:12  ajc
* iconbar.c: removed a stray character or two...

Revision 501.0  2003/10/21 04:26:37  ajc
* THIS IS 5.01

Revision 500.30  2003/10/21 04:26:27  ajc
* bumped the version string to 5.01

Revision 500.29  2003/10/17 03:08:28  ajc
* Finished prettying up the vCard display

Revision 500.28  2003/10/17 02:31:45  ajc
* Multi-line string literals are deprecated in GCC 3.1 unless each line
  is wrapped in quotes.  Performed this fix so it'll compile.
* setup.c: removed references to unused variable tempfile[]

Revision 500.27  2003/10/09 03:17:02  ajc
* Started prettying up the vCard display.

Revision 500.26  2003/10/08 02:33:49  ajc
* Begin work on better handling of vCard display

Revision 500.25  2003/09/04 03:41:27  ajc
* siteconfig.c: changed some config items to drop-down boxes

Revision 500.24  2003/08/27 04:26:54  ajc
* Split the site configuration screen up into four different screens,
  and added a meta-menu

Revision 500.23  2003/08/24 03:31:50  ajc
* Finished the setup program
* Bumped the internal version number to 5.01

Revision 500.22  2003/08/22 00:47:27  ajc
* setup is now working, but it still needs a way to detect a running WebCit

Revision 500.21  2003/08/22 00:25:40  ajc
* Added a skeleton "setup" program to the tree.  It does not work yet.

Revision 500.20  2003/08/20 03:48:55  ajc
* Added iconbar shortcut to Contacts room
* Minimum required Citadel is now 6.11

Revision 500.19  2003/08/20 03:07:25  ajc
* Address book "single card" view now suppresses "reading nn message" and
  instead shows the letter indices across the top
* Clicking on an address in a vCard now connects to WebCit mail instead
  of a browser mailto: link

Revision 500.18  2003/08/19 04:18:43  ajc
* Changed things around in the address book view.  Made it sorted and
  more clickable and better looking...

Revision 500.17  2003/08/12 18:54:03  error
* messages.c: fix off-by-one-error in selector bar

Revision 500.16  2003/08/07 22:18:03  ajc
* Add the Summary Page to the customizable iconbar

Revision 500.15  2003/08/07 03:51:51  ajc
* Customizable icon bar as: pictures and text, pictures, text

Revision 500.14  2003/08/05 03:52:14  ajc
* First working version of the customizable iconbar.  It contains a basic
  set of options and now automatically refreshes when it's customized.

Revision 500.13  2003/08/04 03:50:29  ajc
* First cut at the customizable iconbar is done.  A bunch of generic options
  are there.  Still need to get the actual iconbar to refresh when changes
  are made.

Revision 500.12  2003/08/03 21:02:01  ajc
* More work on customizable iconbar

Revision 500.11  2003/08/02 05:25:46  ajc
* Laid the groundwork for a customizable iconbar

Revision 500.10  2003/07/30 03:57:49  ajc
* Add config.c_purge_hour to config screen

Revision 500.9  2003/07/06 22:06:59  ajc
* When converting "anything that looks like a URL" to a real link, first
  make sure that it isn't already inside a link.  This fixes most of the
  long, ugly URL strings sent by eBay.
* Automatically dismantle mailto: links in HTML messages, and convert
  them to WebCit mail links (clicking on it sends the user to the Mail
  room and begins composing a new message with the recipient and subject
  fields pre-populated).

Revision 500.8  2003/06/29 20:51:21  ajc
* Worked around a rendering bug in Satan's Browser that was causing it
  to draw the calendar month view much wider than the actual screen wdith

Revision 500.7  2003/06/28 04:09:37  error
* roomops.c: Backout change to display one less box in the first column in
  roomlist view, it doesn't seem to work for everyone

Revision 500.6  2003/06/28 03:52:51  error
* Don't tell browsers not to cache static documents

Revision 500.5  2003/06/28 03:35:23  error
* roomops.c: Display one less floor in the first column in romlist view

Revision 500.4  2003/06/26 03:37:58  ajc
* Allow anonymous HTTP requests for /freebusy/user%20name.vcf (or .vfb)
  This will allow some groupware clients to browse the free/busy times of
  other users on the system.

Revision 500.3  2003/06/21 05:17:21  ajc
* Better alignment of system messages
* Exterminated display_error() and replaced it with WC->ImportantMessage
  which is displayed in a bubble on top of whatever page you're on next.
* Small cosmetic changes
* Fixed some nesting problems in output_headers()

Revision 500.2  2003/06/20 03:39:27  ajc
* Optimization to floor layout in box view

Revision 500.1  2003/06/20 03:04:26  ajc
* "Reply" button on messages now handles IGnet recipients correctly

Revision 500.0  2003/06/10 04:23:08  ajc
* THIS IS 5.00

Revision 410.50  2003/06/10 04:22:58  ajc
* Updated docs and headers for 5.00 release

Revision 410.49  2003/06/10 04:05:23  ajc
* De-tabled the left side icon bar and reduced one of the graphics, so
  that all of the rounded corners show up in Satan's Browser.

Revision 410.48  2003/06/10 03:47:41  ajc
* style.css: added font selection to default <BODY> tag

Revision 410.47  2003/06/06 03:26:03  ajc
* Satan's Browser insists on putting bloody acres of whitespace to the
  right of any bulleted list items, making any multi-column table containing
  a list take more than the entire screen.  Removed all such lists so it
  looks ok.  If you are reading this and you are a Microsoft employee, please
  commit suicide before you break anything else.

Revision 410.46  2003/06/06 02:22:07  ajc
* Changed the upper left and upper right bounded box corners to a solid
  blue (#204B78) instead of gradiated, because it was looking funny in
  256-color mode.  It also looked funny in Internet Explorer, but people
  who use Internet Explorer are contributing to terrorism and really don't
  deserve Web access in the first place.  So I really just fixed this to make
  it look good in 256-color Netscape.

Revision 410.45  2003/06/05 21:37:37  ajc
* Cosmetic changes.  Attempting to fix b0rken rendering of main menu
  in b0rken IE browser.  Die, Bill, Die.

Revision 410.44  2003/06/05 03:52:29  ajc
* Buncha cosmetic changes

Revision 410.43  2003/06/04 03:41:25  ajc
* Change the appearance of rooms with and without new messages in the
  room list -- now defined using CSS

Revision 410.42  2003/06/03 03:57:42  ajc
* Tightened up the room banner a bit.  Smaller padding, smaller font,
  smaller images.

Revision 410.41  2003/05/31 21:36:45  ajc
* Cosmetic changes

Revision 410.40  2003/05/26 21:05:42  ajc
* availability.c: brought over ical_ctdl_is_overlap() from Citadel.  Used
  it to complete the free/busy checking for attendee availability.

Revision 410.39  2003/05/26 05:44:45  ajc
* event.c: fix compiler warning

Revision 410.38  2003/05/26 05:39:46  ajc
* webcit.h: change minimum required Citadel server to 6.07 due to FREEBUSY
  bug fixed in Citadel.

Revision 410.37  2003/05/26 05:28:13  ajc
* serv_func.c: added utility function read_server_text()
* availability.c: banged out more of this code -- still not complete

Revision 410.36  2003/05/26 03:28:02  ajc
* Getting closer to doing the availability check.  Created new source
  module 'availability.c' for this purpose.  Stub function is in place.

Revision 410.35  2003/05/25 04:25:12  ajc
* siteconfig.c: fixed a spelling error
* event.c: add a "Check attendee availability" button, and the code to
  bypass saving the event to the server, do something with it, and then
  feed the twiddled data structure back to the form display function for
  further editing.  What's still missing is the code to do the actual
  availability check.

Revision 410.34  2003/05/24 22:22:35  ajc
* Small stylesheet hack to make it work with b0rken IE

Revision 410.33  2003/05/24 22:13:08  ajc
* Changed the login banner a bit

Revision 410.32  2003/05/20 03:25:41  ajc
* Separate event invitees with newlines instead of commas.

Revision 410.31  2003/05/19 19:55:09  ajc
* summary.c: eliminate compiler warnings about unused variables when
  compiling a WebCit service without calendar support

Revision 410.30  2003/05/18 02:05:33  ajc
* More conversion of screens to the new look-and-feel.

Revision 410.29  2003/05/16 04:11:29  ajc
* We don't need no steenking workaround.  Problem fixed.  MIME parser not
  broken.  Web server was calling it with bad parameters.  All fixed now.
* Slightly tweaked the look of the tabs in the room edit screen.  Still looks
  like crap.

Revision 410.28  2003/05/15 04:52:26  ajc
* Minor workaround in web forms to handle mime parser problem in uploads

Revision 410.27  2003/05/15 03:35:59  ajc
* look and feel overhaul -- almost done!

Revision 410.26  2003/05/14 03:46:35  ajc
* More background cleanup

Revision 410.25  2003/05/05 17:19:46  ajc
* Cleanups to summary page when running on a non ical enabled system
* Use non breaking spaces in summary page box titles

Revision 410.24  2003/05/04 04:22:41  ajc
* Display body of messages on a white background.  I am doing this in order
  to prepare for making the general background of the screen a darker color.

Revision 410.23  2003/05/04 02:54:55  ajc
* Summary page now uses our cutesy new rounded window boxes

Revision 410.22  2003/05/03 21:28:41  ajc
* Added in a slick new box style and put the room lists in it

Revision 410.21  2003/05/03 16:57:04  ajc
* In the 'folders' and 'portal' views, change the folder delimiter
  from / to \ to avoid conflict with room names that have slashes

Revision 410.20  2003/05/03 16:23:29  ajc
* Enforce three columns in portal view of room list

Revision 410.19  2003/05/03 04:52:32  ajc
* Added an experimental new "portal view" to the room list options

Revision 410.18  2003/05/02 03:23:41  ajc
* Minor change to room list algorithm

Revision 410.17  2003/05/01 15:33:05  ajc
* Fixed a potential memory leak in enumeration of MIME parts

Revision 410.16  2003/05/01 03:11:35  ajc
* When static content is requested, fetch it without trying to connect
  to Citadel first.

Revision 410.15  2003/04/30 05:00:00  ajc
* Added the ability to compose messages with file attachments uploaded from
  the browser

Revision 410.14  2003/04/27 04:46:02  ajc
* Replace LKRN/LKRO in "folders view" room list with a single LKRA that
  observes the flag designating the presence of new messages.  (The "rooms
  view" uses an LKRN/LKRO pair *per floor* and has the same inefficiency,
  but that view may get axed soon.)

Revision 410.13  2003/04/26 21:57:53  ajc
* tcp_sockets.c: when an outgoing socket connection fails, close the socket
  before returning an error code to avoid a file descriptor leak

Revision 410.12  2003/04/19 21:42:36  ajc
* Repaired all my b0rken COLOR tags
* Replaced most FONT tags with SPAN tags
* Added new styles

Revision 410.11  2003/04/19 19:58:10  ajc
* Lots of great changes from Nick to make the site CSS-enabled.

Revision 410.10  2003/04/14 04:04:40  ajc
* First cut of CSS-izing WebCit.  Probably b0rken.

Revision 410.9  2003/04/09 04:02:32  ajc
* Remove the defaulthost/defaultport vs. c_host/c_port stuff -- we haven't
  supported the idea of one WebCit connecting to multiple Citadels for a
  long time.  Now it's just one set of variables, called ctdlhost/ctdlport.
* When connecting to Citadel through a Unix domain socket, don't try to make
  the Java chat applet available.

Revision 410.8  2003/03/31 03:32:19  ajc
* messages.c: check for 000 terminator while parsing RFC822 headers to
  prevent getting hung up while displaying certain badly formatted messages.

Revision 410.7  2003/03/30 06:13:19  ajc
* When reading from the server, do not treat CR as end-of-line because
  there's probably an LF coming after it.  Instead, keep reading to the LF
  and then strip both.
* Do not underline links in the icon bars

Revision 410.6  2003/03/17 04:17:41  ajc
* Call to accept() was being made with an uninitialized variable for the
  third argument.  Changed the second and third argument to NULL and 0 because
  we don't really need accept() to fill up a buffer full of information that
  we'll never use.  (Thanks to SteveV for reporting the bug and helping to
  troubleshoot it.)
* Removed the mutex wrapper around select() because we don't need it.  All
  idle worker threads now block on select() and one of them will wake up when
  a connection arrives.

Revision 410.5  2003/03/15 20:55:03  ajc
* When a requested image is not available on the Citadel server, send a
  1x1 transparent GIF instead of 404 error.

Revision 410.4  2003/03/14 04:21:57  ajc
* clone events to be encapsulated before saving, because the original
  instance may already have a parent, and that makes crashy crashy

Revision 410.3  2003/03/13 05:57:17  ajc
* More encapsulation.  Warning: there are bugs in this!!

Revision 410.2  2003/03/13 05:20:23  ajc
* Various changes to the calendar service to handle messages containing
  fully encapsulated VCALENDAR components instead of only unencapsulated
  VEVENT subcomponents.  We have to move in this direction for compatibility
  with other products.

Revision 410.1  2003/03/01 22:07:19  ajc
* New user registration, as well as existing user re-registration, now
  uses the vCard editing screen.
* Administratively editing users' address book entries now works again,
  mainly due to a fix in the Citadel server.  Now requiring Citadel 6.06
  in order to enforce this.

Revision 410.0  2003/02/19 03:49:33  ajc
* THIS IS 4.10

Revision 400.90  2003/02/19 03:49:17  ajc
* latest config.guess and config.sub from www.gnu.org

Revision 400.89  2003/02/07 04:44:17  ajc
* Replaced sleep() with a function that sleeps using select() in order to
  avoid potential issues with SIGALRM.  Possible fix for weird behavior
  when running on a Macintosh.

Revision 400.88  2003/01/29 22:32:07  ajc
* Shuffled some code and comments around; minor cleanup

Revision 400.87  2003/01/28 15:37:12  ajc
* All functions which read binary data from the server now make use of the
  read_server_binary() function in tools.c
* Binary reads from server now have safety code to prevent infinite loops
* All output of MIME objects is now done with http_transmit_thing()

Revision 400.86  2003/01/19 06:28:04  ajc
* Minimum required Citadel version 6.05

Revision 400.85  2003/01/16 04:41:26  ajc
* When displaying edit controls for time of day in the calendar, only show
  minutes that are multiples of 5 ... unless the existing value is not a
  multiple of 5, in which case we show that too.

Revision 400.84  2003/01/15 17:34:04  ajc
* event.c: fixed a misspelling
* config.guess, config.sub: updated using latest from ftp.gnu.org

Revision 400.83  2003/01/14 04:21:27  ajc
* Only offer views which make sense for the default view of a room

Revision 400.82  2003/01/13 03:34:33  ajc
* Get ready for the 4.10 release

Revision 400.81  2003/01/12 23:22:53  ajc
* configure.in: check for libical v0.24 or newer

Revision 400.80  2003/01/07 04:56:17  ajc
* Complete the free/busy transparency handling in the form
* Default times for new events are now in the correct timezone

Revision 400.79  2003/01/06 18:01:35  ajc
* Begin handling of TRANSP property to show event times as free or
  busy (not finished).

Revision 400.78  2003/01/05 21:02:14  ajc
* Summary page: three columns are now all the same width

Revision 400.77  2003/01/05 20:56:05  ajc
* minor fix for previous checkin

Revision 400.76  2003/01/05 20:51:01  ajc
* Display PARTSTAT for attendees

Revision 400.75  2003/01/05 05:01:00  ajc
* Add "today's calendar events" to the summary page.

Revision 400.74  2003/01/05 04:27:28  ajc
* Add "Tasks" to the summary page

Revision 400.73  2002/12/28 05:44:09  ajc
* ical_dezonify.c: brought over new version from the Citadel source (again)

Revision 400.72  2002/12/28 05:12:45  ajc
* ical_dezonify.c: brought over new version from the Citadel source.

Revision 400.71  2002/12/26 04:04:48  ajc
* Perform CHEK command when automatically establishing sessions, not just
  when one is explicitly created.  Some stuff is missing otherwise.

Revision 400.70  2002/12/25 23:18:06  ajc
* Be more strategic about when to call ical_dezonify()
  (This may be the last set of fixes.  I hope so.)

Revision 400.69  2002/12/25 21:39:38  ajc
* ical_dezonify.c: added.
* calendar.c: convert incoming ical messages to UTC
  (the usual routines will then convert them to local time for display)

Revision 400.68  2002/12/25 07:06:00  ajc
* Tweaked the code to work with libical 0.24

Revision 400.67  2002/12/20 04:50:00  ajc
* When saving a calendar event, increment the SEQUENCE property.

Revision 400.66  2002/12/18 05:03:39  ajc
* In the calendar code, changed all "struct tm *" to "struct tm" and changed
  all "tm = localtime(foo)" to "memcpy(&tm, localtime(foo), sizeof(struct tm))"
  Because the libc-allocated buffer was getting clobbered.
* This fixes the problem fleeb reported with Feb 1 events making it go nuts.

Revision 400.65  2002/12/17 05:01:39  ajc
* Prettied up the calendar day view layout
* Hour/minute editing fields now use am/pm hours and 2-digit minutes

Revision 400.64  2002/12/16 04:43:30  ajc
* Correctly handle local time zone when figuring out which day and time to
  display events on calendar month/day views.  This also seems to have
  fixed the bug that was causing events to sometimes get lost when saved.

Revision 400.63  2002/12/15 05:50:59  ajc
* Form editing of date/time fields now assumes that the icaltimetype being
  manipulated is in UTC.  It converts to/from local time for editing.

Revision 400.62  2002/12/10 23:25:47  ajc
* Display attendees in message view of calendar objects

Revision 400.61  2002/12/07 22:12:59  ajc
* Handle incoming RSVP's for meetings.  (Note: this will not actually work
  until I implement the Citadel server function which it calls.)

Revision 400.60  2002/11/30 21:34:51  ajc
* Submit organizer in a hidden field, in case the server needs it

Revision 400.59  2002/11/30 04:46:46  ajc
* First cut at adding/removing attendees to an event
  (Actual invitations should be sent by the Citadel server)

Revision 400.58  2002/11/29 23:56:19  ajc
* Completed "me as organizer" -- the user's own e-mail address is inserted
  as the organizer of new events.  Detect when the user is the organizer and
  enable/disable the attendees box accordingly.

Revision 400.57  2002/11/29 16:38:37  ajc
* Started some "me as organizer" stuff.  (BROKEN BUILD ... I'll fix soon.)

Revision 400.56  2002/11/28 06:03:24  ajc
* Issue an ISME command when editing an event, to determine whether the user
  viewing the event is the organizer.  (Will use this later to allow/disallow
  sending out invitations.)

Revision 400.55  2002/11/26 05:01:04  ajc
* Began handling attendee fields

Revision 400.54  2002/11/16 23:40:11  ajc
* Calendar view

Revision 400.53  2002/11/16 23:15:02  ajc
* Make the "all day event" shadebox smaller (month view) - no border.
* Fixed bug that caused any events following an all day event to also appear
  with the shadebox.

Revision 400.52  2002/11/16 05:40:54  ajc
* When adding new events to the calendar, default to the month [and day]
  currently being viewed.
* Hotlink each hour of the day view to an add-new-event for that day/hour.

Revision 400.51  2002/11/15 05:05:47  ajc
* Put in back/forward (yesterday/tomorrow) links in calendar day view

Revision 400.50  2002/11/15 04:11:46  ajc
* Added even more nifty JavaScript to cause the hour/minute and end date
  fields of a calendar event form to render as disabled when the "all day
  event" box is checked -- not just when the user checks the box, but also
  when the box begins its life already checked.

Revision 400.49  2002/11/14 04:59:40  ajc
* Correctly serialize and save all day events using date instead of date/time

Revision 400.48  2002/11/13 04:49:23  ajc
* "All day event" shows as a single checkbox, instead of one for the start
  time and one for the end time.  Added nifty JavaScript to zero and shade
  the hour/minute and all end time fields when all-day-event is checked.

Revision 400.47  2002/11/12 05:57:27  ajc
* Display a nicer looking screen when replying to calendar invitations
* When displaying day view, don't show all day events twice
* Day or month view: denote all day events by displaying them inside
  a grey box.

Revision 400.46  2002/11/12 03:26:39  ajc
* Tell the user about broken Citadel server connections instead of
  simply printing "Goodbye"

Revision 400.45  2002/10/23 04:11:38  ajc
* Detect when a meeting invitation is actually an update for an existing UID
  and tell the user so.

Revision 400.44  2002/10/21 20:16:38  ajc
* Display conflicts nicely

Revision 400.43  2002/10/21 18:29:14  ajc
* Ask server to hunt for conflicts when displaying a meeting invitation

Revision 400.42  2002/10/19 21:28:32  ajc
* Moved the calendar meeting request reply functionality to the Citadel server

Revision 400.41  2002/10/19 17:10:14  ajc
* Add "Tentative" accept button
* Only display Accept/Tentative/Decline button when method=REQUEST

Revision 400.40  2002/10/19 04:16:37  ajc
* Save an incoming meeting request into the user's calendar.

Revision 400.39  2002/10/18 20:55:05  ajc
* Began work on meeting request accept/decline

Revision 400.38  2002/10/16 19:16:39  ajc
* Fixes and updates to build WebCit on Linux for IBM S/390

Revision 400.37  2002/10/09 04:12:44  ajc
* Templatized trailing HTML
* Templatized "new start page" page
* Added global substitution macros

Revision 400.36  2002/10/09 03:51:01  ajc
* Templatized the <HEAD> section of HTML

Revision 400.35  2002/10/07 23:03:38  ajc
* messages.c: don't display room name field when it's blank

Revision 400.34  2002/10/07 04:10:37  ajc
* When displaying meeting invitations, only show date/time for VEVENT
  subcomponents.  Date/time for other subcomponents are irrelevant.
* Cleaned up HTML display of meeting invitations.

Revision 400.33  2002/10/03 03:40:31  ajc
* Worked on meeting accept/decline a little bit

Revision 400.32  2002/09/30 03:58:35  ajc
* Dabbled in handling incoming meeting requests

Revision 400.31  2002/09/29 20:15:43  ajc
* Completed the calendar day view

Revision 400.30  2002/09/28 04:01:30  ajc
* started fleshing out the calendar day view

Revision 400.29  2002/09/27 21:19:28  ajc
* Add new event

Revision 400.28  2002/09/27 18:31:33  ajc
* Properly handle VEVENT saves (fixed nasty loopy loopy bug)
* After saving a VEVENT, return to the correct calendar view and date

Revision 400.27  2002/09/27 17:15:44  ajc
* Removed the gzip compression stuff due to bugs in Internet Explorer.

Revision 400.26  2002/09/27 04:37:21  ajc
* New, buggy versions of event editing screens

Revision 400.25  2002/09/26 22:00:16  ajc
* Fixed buggy month-selection algorithm (January is month 0 in 'struct tm' but
  month 1 in libical functions)

Revision 400.24  2002/09/25 21:57:13  ajc
* Keep track of msgnums in the two-pass calendar loop, so we can hotlink to
  individual items

Revision 400.23  2002/09/24 04:12:34  ajc
* Rough cut of the two-pass calendar display routines (first pass: go thru
  messages gathering VEVENT items; second pass: render calendar with data)

Revision 400.22  2002/09/23 04:01:33  ajc
* Presentation changes to calendar month view

Revision 400.21  2002/09/22 05:20:27  ajc
* Began implementing month view

Revision 400.20  2002/09/21 04:38:05  ajc
* Added utility functions for displaying vcalendar timestamps in web forms
  and translating form data back to timestamps.
* Completed the "edit task" and "add new task" screens.

Revision 400.19  2002/09/20 20:28:08  ajc
* Smooth transition between "list tasks" & "edit task" screens

Revision 400.18  2002/09/20 03:54:44  ajc
* Display the "Tasks" view as a bulleted list with each task clickable
* Clicking brings up an (unfinished) "edit task" screen

Revision 400.17  2002/09/18 21:44:02  ajc
* display VTODO parameters

Revision 400.16  2002/09/17 04:21:00  ajc
* Handler chains for VCALENDAR and VTODO types

Revision 400.15  2002/09/17 03:37:10  ajc
* Implemented a 'display handler' infrastructure for various groupware types

Revision 400.14  2002/09/16 03:35:12  ajc
* Just a bunch of glue code to iterate through the various types of ical
  objects we could encounter

Revision 400.13  2002/09/15 04:05:41  ajc
* Process calendar object subcomponents

Revision 400.12  2002/09/15 03:40:13  ajc
* calendar.c: added
* When a text/calendar MIME type is discovered in a message, send it to
  the (currently skeleton) parser in calendar.c
* calendar.c: skeleton parser for calendar objects which currently just
  creates an icalcomponent object and frees it.

Revision 400.11  2002/09/15 03:16:24  ajc
* Changed decode_base64() to CtdlDecodeBase64() to avoid conflict with
  function namespace in libical

Revision 400.10  2002/09/15 02:50:55  ajc
* Duh.  I don't need to twiddle CFLAGS when autoconf provides -DHAVE_ZLIB_H

Revision 400.9  2002/09/14 21:33:31  ajc
* Backed out compression of inlines -- not all browsers appear to handle it

Revision 400.8  2002/09/14 20:20:29  ajc
* Attempting to push more stuff through compression.  I've introduced some
  sort of deadlock bug that I can't seem to find yet...

Revision 400.7  2002/09/14 20:00:22  ajc
* Compress output_image() graphics

Revision 400.6  2002/09/14 16:26:35  ajc
* output_image() now reads the entire image from Citadel into a buffer before
  sending it to the browser (for performance reasons, and so it can compress)

Revision 400.5  2002/09/14 04:52:59  ajc
* Look for the "libical" calendaring library and link it in if present...

Revision 400.4  2002/09/14 04:02:36  ajc
* Finished gzip compression of dynamic pages (when browser supports it)

Revision 400.3  2002/09/13 20:40:53  ajc
* Detect when the client browser is capable of gzip encoding
  (actual encoding is not implemented yet)

Revision 400.2  2002/09/13 15:54:40  ajc
* Reversed the above change because I broke it somehow

Revision 400.1  2002/09/11 22:46:59  ajc
* Started adding in compression and calendaring library detects (not finished)

Revision 400.0  2002/09/09 03:56:11  ajc
* This is version 4.00

Revision 323.68  2002/09/09 03:51:01  ajc
* In the HTML-to-HTML converter:
  --> Open links in new window (as with text msgs)
  --> Convert loose URL's to hot links (as with text msgs)

Revision 323.67  2002/09/06 03:59:11  ajc
* Added an "About this server" panel to the Summary page.
  (Useless fluff, but better than an empty column.)

Revision 323.66  2002/08/26 02:57:06  ajc
* Rooms listed on the summary page are now clickable-gotoable

Revision 323.65  2002/08/26 01:24:09  ajc
* Added a "summary" page (rather sparse for now)

Revision 323.64  2002/08/24 15:30:48  ajc
* GET instead of POST for listsub.  Also add a 'Back...' link.

Revision 323.63  2002/08/24 05:59:24  ajc
* Bugfixes and cosmetic changes to listsub system

Revision 323.62  2002/08/23 03:37:19  ajc
* Finished all of the subscribe/unsubscribe/confirm stuff!  (I think)

Revision 323.61  2002/08/22 03:55:47  ajc
* 'unsubscribe' command (but not 'confirm unsubscribe')

Revision 323.60  2002/08/21 21:58:37  ajc
* Completed self-service list subscription via web.
  (Still need to implement unsubscribe.)

Revision 323.59  2002/08/16 22:06:51  ajc
* self-service

Revision 323.58  2002/08/16 03:51:12  ajc
* I think I've finally nailed the 'no session' pages now...

Revision 323.57  2002/08/15 03:49:47  ajc
* Fleshed out the list subscription page a bit

Revision 323.56  2002/08/13 19:55:12  ajc
* Keep track of the HTTP "Host:" header being sent by the browser.
  (We're going to need this in the near future)

Revision 323.55  2002/08/05 16:07:30  ajc
* Moved "edit floor label pic" to the floor editing screen

Revision 323.54  2002/08/05 15:53:00  ajc
* Commands to add, change, delete floors

Revision 323.53  2002/07/26 03:20:04  ajc
* Beautified the folder tabs in "edit room"

Revision 323.52  2002/07/25 04:01:58  ajc
* Final cleanup of changes (finally located and fixed the bug)

Revision 323.51  2002/07/24 04:14:23  ajc
* Minor code cleanup of last night's changes

Revision 323.50  2002/07/23 15:40:54  ajc
* Minor cleanup of previous changes

Revision 323.49  2002/07/23 04:43:58  ajc
* Updated message reading to use the new MSG4 command, so we can do output
  of various types of richtext (mainly HTML).

Revision 323.48  2002/07/16 03:37:24  ajc
* Small change to above

Revision 323.47  2002/07/16 03:23:37  ajc
* Display HTML messages as HTML.  (Wow!)

Revision 323.46  2002/07/13 04:39:59  ajc
* Handle multipart/alternative in a nicer way, giving us the opportunity to
  output HTML instead of converting to text/plain and back.  (Not finished.)

Revision 323.45  2002/07/11 03:17:03  ajc
* hacks to text_to_server() to transmit messages as HTML

Revision 323.44  2002/07/09 04:21:12  ajc
* 'idle' icon

Revision 323.43  2002/07/06 03:10:26  ajc
* Enable a "make this my start page" link that works in lots of places.
  Configures a user's preference of where to go after login.

Revision 323.42  2002/06/19 22:01:31  ajc
* When editing another user's vCard, do a "transient goto" to their config
  room so you don't automatically gain access to their config room.
* When creating a user, go back to the "select user to edit" screen with the
  new user's account name pre-selected.

Revision 323.41  2002/06/17 03:48:44  ajc
* Finished the thing to edit other users' vCards.

Revision 323.40  2002/06/16 21:49:02  ajc
* Administratively edit other users' vCards.  Still needs a couple of lines
  of glue code to make it work.

Revision 323.39  2002/06/15 20:34:39  ajc
* Use safestrncpy() instead of strncpy() where appropriate
* Fixed a memory allocation bug in the vCard parser

Revision 323.38  2002/05/23 03:40:05  ajc
* Brought over a utility function I'll need later

Revision 323.37  2002/05/22 02:34:56  ajc
* Finished room/folder view selector.  Pretty cool.

Revision 323.36  2002/05/22 01:53:23  ajc
* Room list or folder list?  Give the user a choice.  (Has bugs.)

Revision 323.35  2002/05/12 15:21:43  error
* do_template() now parses a .wml file for WAP clients, and a .html file
  for everybody else

Revision 323.34  2002/05/11 22:46:19  error
* Track whether user-agent is a WAP gateway

Revision 323.33  2002/05/11 15:35:07  error
* webcit.c: add MIME types for WAP/WML

Revision 323.32  2002/05/10 15:29:58  ajc
* Hacked the address book view a little bit

Revision 323.31  2002/05/09 03:53:56  ajc
* Began working on address book view

Revision 323.30  2002/05/08 03:38:58  ajc
* Preferences framework

Revision 323.29  2002/05/07 03:57:29  ajc
* In message summary, replace 'Del' links with checkboxes

Revision 323.28  2002/05/05 03:28:15  ajc
* Shuffled around the room banner a bit

Revision 323.27  2002/05/03 19:32:39  ajc
* Finished "folder list" mode (still need to move it to a permanent location)

Revision 323.26  2002/05/03 03:55:17  ajc
* more folder display stuff

Revision 323.25  2002/05/01 22:03:07  ajc
* "folder list" view (not finished)

Revision 323.24  2002/05/01 03:23:31  ajc
* Added a drop-down box to change a user's view of a room.

Revision 323.23  2002/04/28 03:56:47  ajc
* Finished summary mode (for the most part, anyway)

Revision 323.22  2002/04/26 21:13:21  ajc
* Separated "summary mode" message listing into its own function
* Go to summary mode automatically when the server says that view=1

Revision 323.21  2002/04/20 04:14:29  ajc
* Some work on email summary screen

Revision 323.20  2002/03/31 05:02:39  ajc
* Remove "Page another user" link from main menu
* Add "edit my citadel config room" type link from edit user screen

Revision 323.19  2002/03/29 22:30:45  ajc
* Finished the "edit user" screen.

Revision 323.18  2002/03/29 15:18:09  ajc
* yep ... more user edit stuff

Revision 323.17  2002/03/26 19:01:12  ajc
* More edit user stuff

Revision 323.16  2002/03/26 18:23:23  ajc
* Don't display room banner on screens that don't pertain to a particular room
* Initial prep for add/change/delete user accounts screen

Revision 323.15  2002/03/22 04:33:08  ajc
* "vcard edit" button for _other_ users' My Citadel Config rooms as well

Revision 323.14  2002/03/19 04:35:10  ajc
* Brought over yet another new version of the MIME parser from Citadel

Revision 323.13  2002/03/13 03:56:52  ajc
* New site config option "Allow system Aides to gain access to mailboxes"

Revision 323.12  2002/03/12 23:13:57  ajc
* Moved room access controls out of the admin menu and into the room commands
  menu.  Prettied up the access control list screen.

Revision 323.11  2002/03/10 06:07:09  ajc
* Handle multiple Internet e-mail addresses in vCard editor

Revision 323.10  2002/03/07 04:56:09  ajc
* Final polish for initial round of vCard editing functions.  Only show "edit"
  link when editing user's own vCard in the My Citadel Config> room.

Revision 323.9  2002/03/06 05:22:33  ajc
* More vcard editing form stuff

Revision 323.8  2002/03/05 05:05:06  ajc
* More vCard editing stuff

Revision 323.7  2002/03/04 05:28:54  ajc
* Wrote some skeleton code for robust vCard editing

Revision 323.6  2002/03/03 06:58:25  ajc
* Login errors displayed in red

Revision 323.5  2002/03/03 06:52:59  ajc
* Allow editing of the "disable self-service user account creation" site config option

Revision 323.4  2002/02/24 07:02:44  ajc
* Added the ability to enter a Subject: line in messages
* Go to the Mail room when user clicks on the new mail alert icon

Revision 323.3  2002/02/13 22:47:51  ajc
* Added some rudimentary support for displaying vCards as card-looking things

Revision 323.2  2002/02/13 15:04:25  ajc
* Began some hacks for vCard processing

Revision 323.0  2002/01/13 09:07:06  ajc
* THIS IS 3.23

Revision 322.4  2002/01/13 09:06:38  ajc
* Brought over the debugged mime parser from Citadel

Revision 322.3  2002/01/05 06:19:17  error
* Add MIME types text/css and image/png

Revision 322.2  2002/01/03 22:32:38  ajc
* templatized the "prompt for recipient" screen

Revision 322.1  2001/12/28 09:43:05  error
* Client support for hostnames up to 63 characters

Revision 322.0  2001/12/26 23:11:56  ajc
* THIS IS 3.22

Revision 321.1  2001/12/26 23:11:25  ajc
* Minor change to the upload handler, to fix graphics uploads

Revision 321.0  2001/12/26 05:28:02  ajc
* THIS IS 3.21

Revision 320.2  2001/12/26 05:24:11  ajc
* Reverted all of the navbar and iconbar functions back to plain, ordinary
  link tags.  The nifty JavaScript stuff is now used only to light up the
  buttons during mouse hovers, and nothing more.

Revision 320.1  2001/12/25 00:14:44  error
* Fixed the iconbar and navbar buttons; they now work in Netscape 4.x

Revision 320.0  2001/12/21 06:04:03  ajc
* THIS IS 3.20

Revision 301.22  2001/12/21 06:03:54  ajc
* 3.20

Revision 301.21  2001/12/20 05:02:42  ajc
* If you paid for this software, someone is ripping you off.
* Fixed the urlesc() function to use a caller-supplied target buffer.

Revision 301.20  2001/12/18 20:35:29  ajc
* More fun JavaScript-enabled buttons

Revision 301.19  2001/12/18 16:48:06  ajc
* Began testing new JavaScript-enabled k00l light-up buttonz

Revision 301.18  2001/12/18 06:06:20  ajc
* mime parser update

Revision 301.17  2001/12/15 20:51:33  ajc
* "reply" button on pop-up pages

Revision 301.16  2001/12/11 16:02:40  ajc
* Completed support for add/remove mailing list recipients.

Revision 301.15  2001/12/11 15:22:53  ajc
* Began constructing the listserv screen for config (not tested)

Revision 301.14  2001/12/11 05:37:12  ajc
* Finished the share/unshare room screen in Edit Room

Revision 301.13  2001/12/03 04:43:40  ajc
* Brought over an update of the MIME parser from Citadel.

Revision 301.12  2001/12/02 07:09:13  ajc
* Turned the room editing page into a tabbed dialog
* Started adding some of the room sharing stuff

Revision 301.11  2001/11/22 05:17:06  ajc
* Completed the add/change/delete neighbor node screens

Revision 301.10  2001/11/18 01:47:24  ajc
* Tentatively begun the change of networking configuration screens to reflect
  the new network architecture of the server.

Revision 301.9  2001/11/18 01:41:09  ajc
* Brought over the newer string tokenizer from Citadel
* Upgraded all the generic string buffers to 4096 bytes, using the Citadel
  server's convention of #define SIZ 4096

Revision 301.8  2001/11/14 03:20:22  ajc
* Add some more of the newer config settings to the site config screen

Revision 301.7  2001/09/25 03:34:09  ajc
* Fix for WebCit servers running on port 80: detect Windoze worm-of-the-week
  and bail out without bothering the Citadel server.

Revision 301.6  2001/08/22 16:38:06  ajc
* Added the "-c" command line option to generate optional cookies indicating
  the host name of the server.  This makes it easy to put a cluster of WebCit
  servers behind (for example) an Arrowpoint load balancer.

Revision 301.5  2001/08/21 04:02:56  ajc
* Added some more meta-tags to (hopefully) prevent the "lame goto" caused by
  unwanted page caching

Revision 301.4  2001/08/13 03:43:24  ajc
* Got it!

Revision 301.3  2001/08/13 03:40:01  ajc
* Another attempt at focus

Revision 301.2  2001/08/11 04:24:39  ajc
* Attempt at setting focus to msgtext area when entering a message.

Revision 301.1  2001/08/02 03:42:03  ajc
* Changed the wholist to work with the new masquerade semantics

Revision 301.0  2001/06/28 15:05:31  ajc
* tag for 3.01

Revision 300.2  2001/06/28 15:03:49  ajc
* Every generated page now includes a meta tag to disable evil "smart tags"
  (see http://smarttags.manilasites.com/ for more information)

Revision 300.1  2001/06/28 02:39:54  ajc
* Placated users who whine about privacy policy by adding MESG ROOMACCESS to
  the screen where you can create a room...

Revision 300.0  2001/06/27 06:24:06  ajc
* Tagged everything as Version 3.00

Revision 213.25  2001/06/27 06:22:49  ajc
* Updated docs for the 3.00 release

Revision 213.24  2001/06/27 06:16:01  ajc
* Correct generated window name in pop up pages
* Added handling of MIME inline images (not tested)

Revision 213.23  2001/06/22 17:58:20  ajc
* A few performance and tuning cleanups.  Increased the size of the socket
  queue length to 100 for use on big systems.  Also, during startup, the
  initial startup thread now exits after creating the worker threads, instead
  of becoming a worker thread itself.  For some reason Solaris had problems
  with the latter method.

Revision 213.22  2001/06/07 03:16:57  ajc
* Brought over an updated mime parser from Citadel

Revision 213.21  2001/06/06 14:44:25  ajc
* mime_parser.c: #include <pthread.h> so it compiles cleanly

Revision 213.20  2001/05/31 02:26:22  ajc
* Fixed login to take you to the Lobby instead of the next room.

Revision 213.19  2001/05/30 22:37:09  ajc
* Fix to upload handler to recognize browser uploads based on *either* a "name"
  or a "filename" from the MIME parser.

Revision 213.18  2001/05/30 01:06:57  ajc
* Changes to mime parser ... still something wrong

Revision 213.17  2001/05/28 19:27:29  ajc
* Fixed bug which marked all messages in Lobby as old before reading at login

Revision 213.16  2001/05/25 22:39:26  ajc
* Brought over the new MIME parser from Citadel.  WARNING: BROKEN BUILD!!

Revision 213.15  2001/05/23 16:15:23  ajc
* UI changes (pretty frames with no scrollbars)

Revision 213.14  2001/05/22 00:32:17  ajc
* cosmetics

Revision 213.13  2001/05/22 00:02:18  ajc
* Another attempt to fix the fd leak

Revision 213.12  2001/05/19 02:21:40  ajc
* Attempt to fix the dangling sockets.

Revision 213.11  2001/05/15 03:22:25  ajc
* More icon updates and link cleanup type stuff

Revision 213.10  2001/05/06 05:11:48  ajc
* Added paging icon and right-justified it
* Send-page window is now a popup

Revision 213.9  2001/05/04 04:28:10  ajc
* Added "page user" button in wholist

Revision 213.8  2001/05/01 00:49:43  ajc
* more of the UI overhaul

Revision 213.7  2001/04/30 01:49:36  ajc
* more work on UI overhaul

Revision 213.6  2001/04/29 04:39:23  ajc
* User interface overhaul now in progress.  WARNING: incomplete system.

Revision 213.5  2001/04/01 22:13:37  cough
* Modified roomops.c to give users the ability to pick a floor at room
  creation time.

Revision 213.4  2001/02/15 01:21:55  ajc
* Applied a patch submitted by Andru Luvisi to add who-knows-room and
  invite/kickout functionality.

Revision 213.3  2001/01/25 23:10:00  ajc
* "Delete message" button now confirms on client-side using JavaScript

Revision 213.2  2000/12/05 18:39:49  ajc
* Added support for non-USA countries in registration screen (requires the
  latest Citadel server, which supports the country field)

Revision 213.1  2000/10/20 04:27:46  ajc
* zapped_list() -- fixed broken HTML tags.  (Closes bug #76.)

Revision 213.0  2000/10/03 16:44:01  ajc
* Tagged for 2.13 release

Revision 212.16  2000/10/03 03:15:53  ajc
* Cosmetic changes to login screen, menu bar, and message header bar

Revision 212.15  2000/09/28 03:44:52  ajc
* Linked to the bio/photo page from message headers.  I'm not sure I like the
  color scheme, though.

Revision 212.14  2000/09/28 03:37:23  ajc
* who.c: provide links to bio/photo pages for each user in the wholist

Revision 212.13  2000/09/24 21:37:21  ajc
* When reading large numbers of messages, group them in smaller numbers and
  display the selector bar in search engine style (like AltaVista and Google)

Revision 212.12  2000/09/24 04:17:16  ajc
* Templatized the room banner.

Revision 212.11  2000/09/17 03:29:45  ajc
* Templatized the "<BODY BACKGROUND=...>" type stuff that starts each page.

Revision 212.10  2000/09/14 11:43:37  error
Replace occurrences of % throughout the HTML with %% so as to be friendly
to HP/UX printf() and possibly others.

Revision 212.9  2000/09/13 04:13:59  ajc
* Completed the initial hack of the variable substitution template thingy.
  Check out static/login.html to see the first template.

Revision 212.8  2000/09/11 17:08:16  ajc
* Started templatizing the login screen.  Not finished yet.

Revision 212.7  2000/09/11 03:29:50  ajc
* Started working on a variable-substitution thing

Revision 212.6  2000/08/30 03:20:22  ajc
* Put the wholist back into its own window.

Revision 212.5  2000/07/06 03:46:29  ajc
* Fixed the count in 'there are xxx messages remaining."  (Closes bug #61)

Revision 212.4  2000/06/29 04:22:35  ajc
* Changed the format of the wholis (again).  Now it shows up in a frame
  instead of a separate window.

Revision 212.3  2000/06/12 03:28:44  ajc
* added support for multi-line paging

Revision 212.2  2000/06/07 04:11:28  ajc
* HTML changes to room banner

Revision 212.1  2000/05/31 04:29:54  ajc
* Initial support for "summary" (headers only, no body) mode of reading
  messages, and "read one" mode.  For future support of 'traditional' email.

Revision 212.0  2000/05/23 20:35:52  ajc
* Tagged for the 2.12 release

Revision 211.19  2000/05/18 02:33:39  ajc
* Don't call whobbs() directly after changing masq room/host, it screws up the
  refresh.  It now calls an HTTP redirect page instead.
* added http_redirect(char *url) function to accomplish the above

Revision 211.18  2000/05/08 17:24:32  ajc
* Removed HTTP date fields because it was confusing browser caches (weird)
* Moved express messages to a pop-up HTML window (as opposed to a dialog box)

Revision 211.17  2000/05/07 23:46:55  ajc
* added Date: and Last-Modified: headers to HTTP output
* masquerade room/host screen now runs in wholist window, and returns to it

Revision 211.16  2000/05/02 17:32:06  ajc
* Font related changes to html

Revision 211.15  2000/04/20 02:42:23  ajc
* tcp_sockets.c: changed memcpy() to memset() in tcp_connectsock; this was
  crashing every session, every time.  (?)
* End the session after displaying robots.txt or nocookies.html, to prevent
  big session logjams when either of these conditions are met

Revision 211.14  2000/04/15 15:43:46  nbryant
* warning fix for 64-bit compile on ultrasparc. (kids don't try this at home,
  64-bit gcc on sparc is evil)

Revision 211.13  2000/04/06 20:42:03  nbryant
* configure.in: fix a typo

Revision 211.12  2000/04/06 20:37:01  nbryant
* solaris cleanups and warning fixes

Revision 211.11  2000/03/31 03:48:52  ajc
* text_to_server() now behaves the way web users expect text entry to work.
  Soft linebreaks are soft, hard linebreaks are hard.  No indentation.

Revision 211.10  2000/03/31 02:39:06  ajc
* Fixed bugs in "Site configuration" and added new fields.

Revision 211.9  2000/03/31 02:08:45  ajc
* Added "max messages per page" and "read next nnn" stuff to read loop
  (probably not in its final form)

Revision 211.8  2000/03/28 17:02:47  nbryant
* configure.in: check for -lsocket -lnsl on Solaris and other SVR4-alikes

Revision 211.7  2000/03/27 16:18:17  ajc
* Implement multi-room chat as available in Citadel 5.70

Revision 211.6  2000/03/23 04:45:15  ajc
* Experimental move of wholist to a separate auto-refreshing window

Revision 211.5  2000/03/19 22:49:03  ajc
* Made the header-bar buttons more visible
* Added a "reply" header-bar button
* Move "Subject:" lines into the header-bar
* Padded the header-bars by one pixel (nicer looking)
* Changed message date/time output format

Revision 211.4  2000/03/19 19:49:31  ajc
* Added support for unix domain sockets

Revision 211.3  2000/02/11 23:45:04  nbryant
* Makefile.in, configure.in: add, like, some *more* code for FreeBSD
* tcp_sockets.c: include <arpa/inet.h>

Revision 211.2  2000/02/11 23:30:04  nbryant
configure.in: added some code for FreeBSD

Revision 211.1  2000/01/11 04:20:40  ajc
* Add "close window" option to goodbye screen

Revision 211.0  2000/01/04 15:24:16  ajc
* Worked around HTTP bugs in Internet Explorer 5.  Die, Bill, Die.
* This will be released as v2.11; tagged everything as such.

Revision 210.0  1999/12/24 04:57:18  ajc
* 2.10 release

Revision 1.121  1999/12/23 04:54:48  ajc
* Changed session cookie from hexadecimal encoding to base64
* Removed overly verbose logging

Revision 1.120  1999/12/12 18:12:28  ajc
* get http request: clear hold buffer before starting to read in HTTP request.
  This was causing some requests to get corrupted.

Revision 1.119  1999/12/08 18:25:21  ajc
* Increased the size of the backlog queue length passed to accept() and made
  it a configuration parameter in webcit.h

Revision 1.118  1999/12/07 16:09:26  ajc
* Better (non fireworks display mode) handling of broken HTTP sockets

Revision 1.117  1999/12/06 03:40:29  ajc
* Moved a bunch of other global variables to per-session variables

Revision 1.116  1999/12/06 02:05:33  ajc
* Moved global march list into per-session context

Revision 1.115  1999/12/05 18:38:02  ajc
* Auto-scaling worker thread pool size

Revision 1.114  1999/12/05 17:38:41  ajc
* Additional debugging and cleanup

Revision 1.113  1999/12/04 22:16:05  ajc
* Moved all diagnostic output to stderr
* Moved "HTTP/1.0 200 OK" output to output_headers()

Revision 1.112  1999/12/04 21:56:59  ajc
* Finished the overhaul.  Now to tune...

Revision 1.111  1999/12/03 17:59:53  ajc
* BROKEN BUILD.  Wrote most of the session removal code, but some of it is
  pseudocode so the build is currently broken.

Revision 1.110  1999/12/03 16:37:46  ajc
* Repaired HTTP output for image transfers and static content

Revision 1.109  1999/12/03 05:09:54  ajc
* Rewrote the HTTP engine and application coupling to run in a worker thread
  model and to run as a single multithreaded program (eliminated helper
  processes and pipes).  It currently runs but has many large bugs.

Revision 1.108  1999/12/03 00:18:20  ajc
* Added ".c.o" rule to Makefile

Revision 1.107  1999/11/26 03:32:59  ajc
* Started moving all of the global variables into a struct, to facilitate
  multithreaded server.

Revision 1.106  1999/11/26 01:28:10  ajc
* 2.01 release

Revision 1.105  1999/11/04 02:05:02  ajc
* Added 'number of worker threads' to site config screen

Revision 1.104  1999/10/25 02:25:09  ajc
* Shuffled around the room editing commands

Revision 1.103  1999/10/14 04:07:18  ajc
* Cleaned up the bottom-of-page icons

Revision 1.102  1999/10/08 23:58:11  ajc
* Minor bug fix in registration screen

Revision 1.101  1999/10/06 02:44:02  ajc
* Per Nick's request, removed the key bindings stuff.  He knows how to fit
  it back in when it's fixed.  Also added more attempts at cache disabling,
  but it still doesn't work in the StarOffice browser.  I don't know why.

Revision 1.100  1999/10/02 03:26:14  ajc
* Merged in Nick's bit of JavaScript to handle key commands.
  BROKEN BUILD ALERT!!  This runs all the time, even when the cursor is
  in a text field.  Right now you can't even log in.

Revision 1.99  1999/09/01 01:06:11  ajc
* Added "max message length" field in global config screen

Revision 1.98  1999/08/14 18:16:10  ajc
* Fixed escputs() and its friends to properly handle ' (single quote) chars


Sun Jul 18 20:17:58 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Did neat stuff to the bottom of the page

Mon Jul 12 23:30:24 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us> 
	* webcit.c: exit Webcit sessions semi-gracefully when the connection
	  to a Citadel server fails.
	* messages.c: don't auto-link URL's in messages if it would cause
	  a buffer overrun.

Sat Jul 10 17:51:39 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Recompiled the Java chat applet using a genuine JDK 1.0.2
	  compiler.  This should make more browsers happy.

Wed Jun 30 19:19:59 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Added support for "robots.txt" telling spiders to go away.
	* Do a slrp_highest() when logging off.

Sat Jun 26 22:52:13 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Rearranged the code in "Site-wide configuration" and "Generic
	  server command" to avoid nested server operations

Wed Jun 23 21:43:30 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* webcit.c: added "back, top, next" buttons to bottom of each page
	* menubar.html: replaced "User list" with "Page another user"

Tue Jun 22 14:53:05 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* context_loop.c: rearranged some code to try to eliminate deadlocks

Fri Jun 18 11:55:58 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Unknown URL's now display the main menu instead of diagnostics
	* Diagnostics are now at <baseurl>/diagnostics

Mon Jun  7 21:59:45 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Session no longer locks up when an express message is cancelled
	* The default Citadel server is now "localhost" instead of uncnsrd
	* Added some documentation

Thu Jun  3 12:18:49 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* roomops.c: made room banner graphics more reliable
	* messages.c: added code to prevent accidental "double-posting"
	* who.c: fixed the "Change room/host/user" submit logic

Thu Jun  2 09:48:00 EDT 1999 Nick Grossman <nick@ulster.net>
	* Changed static/menubar.html so the text is readable

Wed Jun  2 23:47:58 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Ditched the frames mode completely.  It wasn't working properly in,
	  among other places, IE 5.  Die, Bill, Die.

Sat May 29 00:25:47 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Fixed the behavior of the "forget room" routine, to properly handle
	  the transition back to the Lobby after it's all done.
	* Added ExpressMessageCat() to allow code to send the user messages
	  along with incoming express messages
	* WebCit now sends the name of the end user's browser as the client
	  name in a Citadel IDEN command rather than its own name.

Fri May 21 23:35:17 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Minor code cleanups
	* New mail notification

Mon May 17 20:59:36 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Top-aligned all the cells in the fake frames in non-frames mode

Fri May 14 23:37:02 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Initial entry to _BASEROOM_ at login now done as a Skip instead
	  of a Goto, in order to prevent it from first marking all msgs old.

Mon May 10 23:09:34 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Replaced _most_ gotoroom() calls with smart_goto(), a version
	  which can differentiate the needs of frames and noframes modes

Sat May  8 01:07:06 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* webserver.c: added "-t" option to send traces somewhere else

Tue Apr 27 23:36:35 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* context_loop.c: display an error page if the client browser
	  requests a non-root page and there is no cookie set
	* webserver.c: took my name off the copyright notice (it's a group
	  effort, after all)

Sun Apr 18 23:42:54 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Reworked a lot of the structure, made more HTML "embeddable"
	* Changed the noframes mode to display "fake" frames using tables

Thu Apr 16 12:00:00 EDT 1999 Nick Grossman <nick@ulster.net>
	Changed some output formatting (mainly <FONT> tags).
	Changed who.c to use urlescputs() rather than escputs()
	in urls so GOTOs and User Profiles work when the string has a
	space in it.

Wed Apr 14 17:56:18 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	http://www.webreference.com/dhtml/column18/menuFrLoad.html
	How to cause "onLoad=" to cause a sibling frame to refresh without
	having to use the nonportable HTTP "Window-Target:" directive.  Began
	implementation of this; it should allow portable NS/IE compatibility.

Wed Apr  7 21:51:33 EDT 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Implemented "access level required to create rooms"

Thu Mar 18 00:23:05 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* webcit.c: modified getz() to *exit* the program when fgets()
	  returns an error.  This is actually the desired behavior; it would
	  otherwise busy-loop forever on a broken pipe.

Sat Mar  6 19:56:07 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* webcit.c: added to getz() the ability to return an error code;
	  implemented this in the main loop, hopefully fixing problems
	* Added "braindamage" file (frames/JS browser compatibility list)
	* Added HTTP "User-agent:" detection
	* wildmat.c, braindamage.c: added
	* Initial value of 'noframes' is now set by the braindamage check
	* Ran everything through "indent -kr -i8"
	* roomops.c: in room list, print a &nbsp; in otherwise empty cells

1999-02-24 Nathan Bryant <bryant@cs.usm.maine.edu>
	* context_loop.c: warning fix
	* webcit.c: off_t is a 64-bit `long long' on BSDI (eek!)

Sat Jan 30 19:00:58 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Resolve the name of the connecting host and pass it on to Citadel

Fri Jan 29 14:49:49 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* wDumpContent() is now responsible for </BODY></HTML> most of the
	  time (parameter settable) so that the main menu can easily be
	  embedded in every page when running in noframes mode
	* noframes mode selection is now carried in the cookie

Thu Jan 28 20:30:08 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Made the frames stuff less dependent on the HTML TARGET= directive
	  and more dependent on the HTTP Window-target: directive.
	* Made the system semi-navigable in noframes mode.

Sat Jan 23 19:36:10 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Brought over the new room listing code and <G>oto heuristics
	  from the main Citadel tree, to pay attention to floor/room ordering

Thu Jan 14 17:14:11 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Modified the back end of mime_parser to use callbacks instead of
	  doing something specific.  Now we can use it elsewhere.

Mon Jan 11 21:53:16 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Fixed the bugs in "Site-wide configuration"
	* Added a "generic server commands" screen

Fri Jan  8 22:20:54 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Reduced the multiple cookies down to one cookie combining all data.

Mon Jan  4 23:04:36 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Removed wc_host and wc_port cookies.
	* Added an "edit your session" screen to change your wholisting.

Sun Jan  3 20:05:31 EST 1999 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Added "enter registration"
	* Set up automatic trigger of Enter Registration when the server
	  says it's needed
	* Established that a one-to-one WebCit/Citadel correspondence will
	  be required.  No big deal due to shared code segments.
	* Added "change password"
	* Added networking configuration screens.  These still need testing.
	* Added a "kill session" link to each line of the wholist when
	  logged in as an aide, and the screens to perform this operation.

Thu Dec 31 21:53:20 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Final cvs commit for 1998 (an awful year, I'm glad to see it over).
	* "Finished" the MIME parser.
	* Got image uploads working.
	* Added "add/edit user photo" screens.
	* Added "add/edit room graphic" screens.
	* Added "add/edit floor graphic" screens.
	* Fixed display of floor graphic in known rooms list.

Wed Dec 30 20:36:13 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Wrote mime_parser.c for handling of image uploads.  This will also
	  be used in future Citadel MIME projects.

Tue Dec 29 23:25:50 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Fixed a bug in the room banner display code
	* Added "delete room"
	* Added "validate users"

Mon Dec 28 00:26:01 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Added "edit room info file"
	* Added "edit bio"

Sat Dec 26 23:12:47 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Changed the "auto read new" functionality from a meta refresh tag
	  to an "onload" directive (the former was causing graphics problems)
	* Added "create room"
	* Added "edit room"

Tue Dec 22 22:35:50 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Got the Zap and List-Zapped commands working
	* Added a convenience function to display a page with an error string
	* Automatically do a read-new-msgs whenever a new room banner is loaded

Thu Dec 17 20:38:00 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Added the screens to send pages
	* Changed message headers to display in bigger font, non-boldface
	* Added the chat system
	* Added goto private rooms

Wed Dec 16 16:23:58 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Replace "Citadel" in menu bar with the Citadel logo

1998-12-14 Nathan Bryant <bryant@cs.usm.maine.edu>
	* automatically regenerate Makefile when Makefile.in changes

Sun Dec 13 13:35:12 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* context_loop.c: Moved "remove session" into its own function.
	  Check for dead webcit child process before each transaction.
	* Ignore SIGPIPE; this seems to magically make the program bulletproof
	  against broken HTTP connections.
	* Added a housekeeping thread to periodically remove dead sessions
	  and kill idle sessions.
	* messages.c: added "delete message" functionality
	* messages.c: added "move message" functionality
	* userlist.c: added.  This adds "userlist" and "show user" functions.
	* roomops.c: fixed buggy implementation of ungoto
	* Set up an option in output_headers() to optionally print the most
	  often used opening HTML as well as the HTTP headers.
	* Display express messages in cute little JavaScript popup window.

Fri Dec 11 21:14:36 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Brought over message reading and entry functions from old WebCit

1998-12-10 Nathan Bryant <bryant@cs.usm.maine.edu>
	* context_loop.c: really fix the SO_LINGER stuff
	* webserver.c: remove commented-out references to SO_LINGER

Wed Dec  9 18:50:46 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* context_loop.c: After fork(), child process closes the HTTP socket
	  so when the parent process closes it, it actually _does_ close.
	  Otherwise, aIEeeee and possibly other browsers will hang.
	* Added support for graphics images retrieved from the Citadel server.
	* Set up login banner graphic and background image graphic

1998-12-09 Nathan Bryant <bryant@cs.usm.maine.edu>
	* context_loop.c, webserver.c, webserver.h: SO_LINGER and locking fix

Wed Dec  9 11:13:48 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Smoothed out some of the login/logout code.  Failed authentication
	  now works the way it should.
	* Added support for new user login (still need to handle registration).

Tue Dec  8 15:45:42 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Discovered that the HTTP socket problem is related to a socket that
	  isn't properly lingering on close.  Temporarily hacked a sleep(10)
	  into context_loop.c until it is figured out.

Mon Dec  7 17:03:18 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Did a little debugging, still trying to figure out why logging in
	  displays "Connection reset by peer" error.  It used to work...

1998-12-07 Nathan Bryant <bryant@cs.usm.maine.edu>
	* Makefile.in: updated dependencies

Sun Dec  6 19:50:55 EST 1998 Art Cancro <ajc@uncnsrd.mt-kisco.ny.us>
	* Fixed broken interpretation of variables specified in the URL
	* added new "action" variable to make main loop simpler

1998-12-06 Nathan Bryant <bryant@cs.usm.maine.edu>
	* webserver.c: prototype vsnprintf
	* context_loop.c: warning fix

1998-12-05 Nathan Bryant <bryant@cs.usm.maine.edu>
	* tcp_sockets.c: removed some dead code
	* context_loop.c: oops, I made a memory leak. fix fix fix. also close
	  unused ends of pipes, fix a file descriptor leak and a race condition
	* portability enhancements

1998-12-04 Nathan Bryant <bryant@cs.usm.maine.edu>
	* webserver.c, context_loop.c, webcit.c: add commandline args for host
	  and port
	* converted to autoconf and began port to Digital UNIX
	* warning fixes
	* context_loop.c: moved the monster 64k buffer array off the stack
	* tcp_sockets.c: getservbyname() doesn't set errno.

1998-12-03 Nathan Bryant <bryant@cs.usm.maine.edu>
	* webserver.c: warning fix
